;/*FB_PKG_DELIM*/

__d("EBWorkerODSEntityName.enum",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({MW_EBSM_HYDRATION:"mw_ebsm_hydration",MW_EBSM_IDB:"mw_eb_ebsm_idb",MW_EBSM_CORRUPTION:"mw_ebsm_corruption",MW_EBSM_RESTORE_PERSISTENCE_ERROR:"mw_ebsm_restore_persistence",MW_EBSM_IDB_TABLE_DELETION:"mw_ebsm_idb_table_deletion",MW_EB_AUTO_RESTORE_AUTH_WORKER:"mw_eb_auto_restore_auth_worker",MW_EB_AUTO_RESTORE_AUTH_MAIN_THREAD:"mw_eb_auto_restore_auth_main_thread",MW_EB_DEVICE_MIGRATION_WORKER:"mw_eb_device_migration_worker",EB_WORKER_ADD_DEVICE_WITH_KEYS:"eb_worker_add_device_with_keys",EB_WORKER_ADD_DEVICE_WITH_RC:"eb_worker_add_device_with_rc",EB_WORKER_OPT_OUT:"eb_worker_opt_out"});c=a;f["default"]=c}),66);
__d("LSContactGender",[],(function(a,b,c,d,e,f){a=Object.freeze({UNKNOWN:0,FEMALE:1,MALE:2,NEUTER:3});f["default"]=a}),66);
__d("LSEncryptedBackupsClientRestoreState",[],(function(a,b,c,d,e,f){a=Object.freeze({RESTORE_IN_PROGRESS:1,RESTORE_COMPLETE:2});f["default"]=a}),66);
__d("LSEncryptedBackupsOpStatus",[],(function(a,b,c,d,e,f){a=Object.freeze({SUCCESS:0,FAILURE:1,UNKNOWN:2});f["default"]=a}),66);
__d("MAWRestoreRewriteUtils",["qex"],(function(a,b,c,d,e,f,g){"use strict";a=function(){return c("qex")._("656")===!0};g.isOneDBEnabled=a}),98);
__d("LSGetLatestThreadIds.nop",["ExecutionEnvironment","I64","LSVec","MAWBridge","MAWBridgeSafeActionsWorkerAndUI","MAWRestoreRewriteUtils","Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var f=[];e=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(e.mi_act_mapping_table)).then(function(a){return a.map(function(a){a=a.jid;return(j||(j=d("I64"))).to_string(a)})}));if(e.length>0){var g=new Set(e);a.forEach(function(a){g.has(a)&&f.push(a)})}return(i||(i=b("Promise"))).resolve([c("LSVec").ofArray(f),!0])});return l.apply(this,arguments)}function m(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableDescending(a.e2ee_threads.index("threadOrder")).take((j||(j=d("I64"))).to_int32(b))));return a.map(function(a){a=a.jid;return a.split("@")[0]})});return n.apply(this,arguments)}function o(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("MAWBridgeSafeActionsWorkerAndUI").sendAndReceiveBackendWorkerAndUIShared("getLatestThreadIds",{numThreads:(j||(j=d("I64"))).to_int32(a)}));return a});return p.apply(this,arguments)}a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,l){l===void 0&&(l=!1);if((h||(h=c("ExecutionEnvironment"))).isInWorker)return d("MAWBridge").getBridge().sendAndReceive("event","getLSDBLatestThreadIds",{miActMappingFilteredThreads:l,numThreads:g});if((j||(j=d("I64"))).gt(g,(j||(j=d("I64"))).zero))try{e=d("MAWRestoreRewriteUtils").isOneDBEnabled()?yield m(a,g):yield o(g);return l?k(e,a):(i||(i=b("Promise"))).resolve([c("LSVec").ofArray(e),!0])}catch(a){return(i||(i=b("Promise"))).resolve([c("LSVec").ofArray([]),!1])}return(i||(i=b("Promise"))).resolve([c("LSVec").ofArray([]),!0])});function e(b,c,d,e,f){return a.apply(this,arguments)}return e}();a.__nop_name__="LSGetLatestThreadIds";g["default"]=a}),98);
__d("LSInitSyncCompleteSubscription",["I64","LSIntEnum","Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(a,c){return new(j||(j=b("Promise")))(function(b,e){var f=d("ReQL").fromTableAscending(a.tables.sync_groups).getKeyRange(c).subscribe(function(a,c){if(c.operation==="delete")return;if((h||(h=d("I64"))).equal(c.value.syncStatus,(i||(i=d("LSIntEnum"))).ofNumber(2))){f();return b()}})})}function a(a,b){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.sync_groups).getKeyRange(b)).then(function(c){if(c!=null&&(h||(h=d("I64"))).equal(c.syncStatus,(i||(i=d("LSIntEnum"))).ofNumber(2)))return;return k(a,b)})}function c(a){return k(a,(i||(i=d("LSIntEnum"))).ofNumber(1))}g.maybeWaitForSyncGroup=a;g.use=c}),98);
__d("MAWAsyncEBPendingQueryPromise",["Promise"],(function(a,b,c,d,e,f){"use strict";var g,h=new Map(),i=new Map(),j=new Map(),k=new Map(),l=new Map(),m=new Map();function a(a){var c=new(g||(g=b("Promise")))(function(b,c){i.set(a,b),k.set(a,c)});h.set(a,c);return c}function c(a,b){j.set(a,b)}function d(a){return j.get(a)}function e(a){var c=new(g||(g=b("Promise")))(function(b,c){l.set(a,{data:null,resolve:b}),m.set(a,c)});return c}function n(a,b){var c=i.get(a);c!=null&&(i["delete"](a),c(b));c=l.get(a);c!=null&&l.set(a,{data:b,resolve:c.resolve})}function o(a,b){var c=k.get(a);c!=null&&(i["delete"](a),c(b));c=m.get(a);c!=null&&(m["delete"](a),c(b),l["delete"](a))}function p(a){var b=l.get(a);b!=null&&b.data!=null&&(b.resolve(b.data),l["delete"](a),m["delete"](a))}f.getPendingQueryPromiseFromTrace=a;f.setJidFromThreadId=c;f.getJidFromThreadId=d;f.getWaitForRestorePromiseFromTrace=e;f.resolvePendingQueryIfPresent=n;f.rejectPendingQueryIfPresent=o;f.resolvePendingQueryUponReStore=p}),66);
__d("MAWBridgeDropAllSecureThreadsHandler",["I64","LSIntEnum","LSMessagingThreadTypeUtil","Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(a){var c=d("ReQL").fromTableAscending(a.threads_ranges_v2__generated).filter(function(a){return(i||(i=d("I64"))).equal(a.parentThreadKey,(j||(j=d("LSIntEnum"))).ofNumber(-1))||(i||(i=d("I64"))).equal(a.parentThreadKey,(j||(j=d("LSIntEnum"))).ofNumber(-10))});return d("ReQL").toArrayAsync(c).then(function(c){return c.reduce(function(b,c){return b.then(function(){return a.threads_ranges_v2__generated["delete"](c.parentThreadKey,c.minThreadKey,c.minLastActivityTimestampMs)})},(h||(h=b("Promise"))).resolve())})}function l(a){var c=d("ReQL").fromTableAscending(a.threads).filter(function(a){return d("LSMessagingThreadTypeUtil").isArmadilloSecure(a.threadType)});return d("ReQL").toArrayAsync(c).then(function(c){return c.reduce(function(b,c){return b.then(function(){return a.threads["delete"](c.threadKey)})},(h||(h=b("Promise"))).resolve())})}function a(a){return(h||(h=b("Promise"))).all([k(a),l(a)]).then(function(){return(h||(h=b("Promise"))).resolve()})}g.call=a}),98);
__d("MAWTrackPendingOccamadilloThreads",["Deferred","LSDatabaseSingleton","LSInitSyncCompleteSubscription","LSIntEnum","LSPlatformLsInitLog","MAWMIC","MAWMICSchema","QuickPerformanceLogger","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=(h={},h[d("MAWMICSchema").ANNOTATIONS.occamadilloBatchesSentToWorker]=0,h[d("MAWMICSchema").ANNOTATIONS.occamadilloPendingThreadsAfterInitSync]=0,h[d("MAWMICSchema").ANNOTATIONS.occamadilloDuplicateThreads]=0,h);(function(){Object.keys(l).forEach(function(a){d("MAWMIC").addIntAnnotation(a,0)})})();function m(a){d("MAWMIC").addIntAnnotation(a,++l[a])}function a(){return l.occamadilloBatchesSentToWorker}var n=new(c("Deferred"))(),o=new Set(),p=new Set(),q=new Set(),r=new Set();function e(a){a=a.callingSource;r.add((k||(k=d("LSIntEnum"))).toNumber(a));d("MAWMIC").addIntArrayAnnotation(d("MAWMICSchema").ANNOTATIONS.occamadilloCallingSources,Array.from(r))}function f(a){d("MAWMIC").addPoint(d("MAWMICSchema").POINTS.thread_mapping_start);if(o.has(a)){m(d("MAWMICSchema").ANNOTATIONS.occamadilloDuplicateThreads);return}p.add(a);d("LSPlatformLsInitLog").LsSync.isRunning()&&q.add(a);(i||(i=c("QuickPerformanceLogger"))).currentTimestamp();o.add(a);d("MAWMIC").addIntAnnotation("occamadilloThreadCount",o.size);d("LSPlatformLsInitLog").LsSync.hasEnded()&&m(d("MAWMICSchema").ANNOTATIONS.occamadilloPendingThreadsAfterInitSync)}function s(){d("MAWMIC").addBoolAnnotation("threadMappingAcked",!0)}function t(a){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(c("gkx")("2661"))yield n.getPromise();else{var b=(yield (j||(j=d("LSDatabaseSingleton"))).LSDatabaseSingleton);yield d("LSInitSyncCompleteSubscription").maybeWaitForSyncGroup(b,(k||(k=d("LSIntEnum"))).ofNumber(95))}p["delete"](a);q["delete"](a);d("MAWMIC").addIntAnnotation("occamadilloCompleteThreadCount",o.size-p.size);w()});return u.apply(this,arguments)}function v(){n.resolve(),w()}function w(){d("MAWMIC").addIntAnnotation("occamadilloThreadCount",o.size);if(d("LSPlatformLsInitLog").LsSync.hasEnded()&&q.size===0){d("MAWMIC").addPoint(d("MAWMICSchema").POINTS.thread_mapping_end);return}p.size===0&&d("MAWMIC").addPoint(d("MAWMICSchema").POINTS.thread_mapping_end)}g.incrementCounter=m;g.getBatchesSentNumber=a;g.markThreadPassedToNativeOp=e;g.addPendingThread=f;g.markBridgeCallAcked=s;g.removePendingThread=t;g.completeSync=v;g.maybeEndOccamadilloThreadMapping=w}),98);
__d("MAWWorkerEvent",["FBLogger","MAWMIC","MAWReliabilityMonitor","MAWSetupWorkerAuxStateForLogging","MAWTrackPendingOccamadilloThreads","MultipleTabsLogger","QPLUserFlow","performanceNow","promiseDone","qpl","requireDeferred","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("MAWBridgeObserver").__setRef("MAWWorkerEvent"),j=new Set(),k=new Set(["addEbUploadTrackingWorkerQPL","ackWithInstanceKey","addMediaDownloadQpl","searchGetFTSRestoreSessionId","none"]),l=new Set(["bulkCreateThread","createThread"]),m=new Map(),n=function(a){switch(a){case"sendAndReceive":return 1e4;case"fireAndForget":return 4e3;case"waitUntilCompleted":return 1e4;case"waitUntilPersisted":return 1e4;default:return 1e4}},o=function(a,b,d){d=window.setTimeout(function(){u(a,"ack_timeout"),c("promiseDone")(i.load().then(function(a){a.notifyUnackedEvent({route:b,timestamp:(h||(h=c("performanceNow")))()})}))},n(d));m.set(a,d);return d},p=function(a){var b=m.get(a);b!=null&&(window.clearTimeout(b),c("promiseDone")(i.load().then(function(a){a.resetUnackedMessages()})),m["delete"](a))};function a(a,b,e){if(j.has(e)||k.has(b))return;j.add(e);c("QPLUserFlow").start(c("qpl")._(1056842055,"807"),{annotations:{bool:{duringMIC:d("MAWMIC").duringMIC(),useSharedWorker:d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()},"int":{key:e},string:{callType:a,event:b}},instanceKey:e});void d("MultipleTabsLogger").hasMultipleTabs().then(function(a){c("QPLUserFlow").addAnnotations(c("qpl")._(1056842055,"807"),{bool:{isMultiTabs:a}},{instanceKey:e})})}function b(a){if(!j.has(a))return;j["delete"](a);c("QPLUserFlow").endSuccess(c("qpl")._(1056842055,"807"),{instanceKey:a})}function e(a,b){if(!j.has(a))return;j["delete"](a);c("QPLUserFlow").endFailure(c("qpl")._(1056842055,"807"),"fail",{annotations:{string:{error:b},string_array:{worker_restart_msgs:d("MAWSetupWorkerAuxStateForLogging").restartMessageTypes,worker_restart_reasons:d("MAWSetupWorkerAuxStateForLogging").restartReasons}},instanceKey:a})}function f(a,b,e){if(!j.has(a))return;j["delete"](a);c("QPLUserFlow").endFailure(c("qpl")._(1056842055,"807"),"timeout",{annotations:{bool:{workerHealthStatus:e},string:{error:b},string_array:{worker_restart_msgs:d("MAWSetupWorkerAuxStateForLogging").restartMessageTypes,worker_restart_reasons:d("MAWSetupWorkerAuxStateForLogging").restartReasons}},instanceKey:a})}function q(a,b){if(!j.has(a))return;c("QPLUserFlow").addAnnotations(c("qpl")._(1056842055,"807"),b,{instanceKey:a})}function r(a,b){if(!j.has(a))return;try{if(Array.isArray(b)){var e=b.every(function(a){return typeof a==="object"&&a!=null&&"state"in a&&a.state===d("MAWReliabilityMonitor").HealthReportState.OK.valueOf()});b=b.reduce(function(a,b){typeof b==="object"&&b!=null&&"state"in b&&"identifier"in b&&"reason"in b&&b.state!==d("MAWReliabilityMonitor").HealthReportState.OK.valueOf()&&typeof b.state==="string"&&typeof b.reason==="string"&&typeof b.identifier==="string"&&a.push([b.identifier,b.state,b.reason].join(":"));return a},[]);q(a,{bool:{workerHealthStatus:e},string:{error:(a=b[0])!=null?a:void 0},string_array:{errors:b}})}}catch(a){c("FBLogger")("messenger_e2ee_web").catching(a).mustfix("Failed to log ack result annotations");return!1}}function s(a,b,c){if(typeof c==="object"&&typeof (c==null?void 0:c.timestamp)==="number"){c=c.payload;p(a);u(a,"ack");r(a,c);l.has(b)&&d("MAWTrackPendingOccamadilloThreads").markBridgeCallAcked()}}function t(a,b,c){k.has(b)||o(a,b,c),u(a,"send")}function u(a,b,d){if(!j.has(a))return;c("QPLUserFlow").addPoint(c("qpl")._(1056842055,"807"),b,{instanceKey:a,timestamp:d})}g.getUnackedEventTimeout=n;g.logStart=a;g.logSuccess=b;g.logFailure=e;g.logTimeoutFailure=f;g.logAnnotations=q;g.logAck=s;g.logSend=t}),98);
__d("MAWBridgeLoggingUtils",["MAWWorkerEvent","ODS","Random","WAHashStringToNumber"],(function(a,b,c,d,e,f,g){"use strict";var h,i=3185,j="armadillo_worker_runtime",k=10,l=new Array(k);function m(a,b,c){(h||(h=d("ODS"))).bumpEntityKey(i,j,a+"_"+b+"_"+c)}function a(a){return d("WAHashStringToNumber").hashStringToNumber(a+Math.round(d("Random").random()*1e4)+1e4)}function b(a,b,c,e){m(b,c,"start"),(h||(h=d("ODS"))).bumpEntityKey(i,j,"route_start"),d("MAWWorkerEvent").logStart(a,c,e),l.length===k&&l.shift(),l.push(b+"_"+c)}function n(a){l.filter(Boolean).forEach(function(b){(h||(h=d("ODS"))).bumpEntityKey(i,j,b+a)})}function c(a,b,c){m(a,b,"success"),(h||(h=d("ODS"))).bumpEntityKey(i,j,"route_success"),d("MAWWorkerEvent").logSuccess(c)}function e(a,b,c,e){m(a,b,"fail"),(h||(h=d("ODS"))).bumpEntityKey(i,j,"route_fail"),d("MAWWorkerEvent").logFailure(e,c)}function f(a,b,c,e){m(a,b,"timeout"),(h||(h=d("ODS"))).bumpEntityKey(i,j,"route_timeout"),d("MAWWorkerEvent").logTimeoutFailure(c,"Route timeout",e)}function o(){n("_before_unresponsive"),l.fill(null)}g.CAT_ID=i;g.ENT=j;g.RECENT_ROUTES_NUM=k;g.getBridgeEventInstanceKey=a;g.routeStart=b;g.logRecentRoutes=n;g.routeSuccess=c;g.routeFail=e;g.routeTimeoutFail=f;g.logRecentBridgeEvents=o}),98);
__d("MAWStartupLoggingUtils",["FBLogger","MAWInit","MAWMIC","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e){var f;f=(f=b==null?void 0:b.message)!=null?f:"";f.indexOf("Failed to execute 'importScripts'")>=0?d("MAWInit").MAWInit.fail("import_scripts_failure",c("getErrorSafe")(b)):d("MAWInit").MAWInit.fail("worker_error",c("getErrorSafe")(b));c("FBLogger")("messenger_e2ee_web").mustfix("[MAWWebWorkerSingletonAsync: "+a+"]: %s:%s:%s:%s:%s:%s:%s",JSON.stringify(b==null?void 0:b.message),b==null?void 0:b.lineno,b==null?void 0:b.colno,b==null?void 0:b.filename,JSON.stringify(b,window.Object.getOwnPropertyNames(b)),b==null?void 0:b.name,e)}function b(a){var b=function b(d){d=d==null?void 0:d.data;if(typeof d==="object")if((d==null?void 0:d.type)==="importScripts_error"){var e,f;a.removeEventListener("message",b);var g=c("FBLogger")("messenger_e2ee_web");g=g.addMetadata("FBLOGGER","ERROR_STACK",(e=typeof (d==null?void 0:d.stack)==="string"?d==null?void 0:d.stack:JSON.stringify(d==null?void 0:d.stack))!=null?e:"no_stack");e=(e=d)!=null?e:{};var h=e.error_code,i=e.error_msg,j=e.error_name;e=e.source;f=(f=d==null?void 0:d.perfEntry)!=null?f:{};var k=f.duration,l=f.encodedBodySize,m=f.responseStatus;f=f.transferSize;g.mustfix("[MAWWebWorkerSingletonAsync Script Import Error Details]: %s:%s:%s || errCode:%s || respStatus:%s || encBodySize:%s || duration:%s || transferSize:%s",e!=null&&JSON.stringify(e)||"no_source",j!=null&&JSON.stringify(j)||"no_name",i!=null&&JSON.stringify(i)||"no_msg",h!=null&&JSON.stringify(h)||"none",(g=JSON.stringify(m))!=null?g:"none",(e=JSON.stringify(l))!=null?e:"none",(j=JSON.stringify(k))!=null?j:"none",(i=JSON.stringify(f))!=null?i:"none")}else(d==null?void 0:d.type)==="importScripts_success"&&a.removeEventListener("message",b)};a.addEventListener("message",b)}var h=new Set(["worker_connection_established","worker_init_point_hsdp_end","worker_init_point_hblp_end","get_worker_rev_ack_received","old_worker_shutdown_end","old_worker_shutdown_start"]);function e(a){var b=a.data.annotations;if(b!=null){var c={allowEarlyAnnotations:!0};Object.keys(b).forEach(function(a){var e;e=(e=b[a])!=null?e:{};Object.entries(e).forEach(function(b){var e=b[0];b=b[1];e="workerInit"+e.charAt(0).toUpperCase()+e.substring(1);a==="int"&&typeof b==="number"?(d("MAWInit").MAWInit.addIntAnnotation(e,b,c),d("MAWMIC").addIntAnnotation(e,b)):a==="string"&&typeof b==="string"?(d("MAWInit").MAWInit.addStringAnnotation(e,b,c),d("MAWMIC").addStringAnnotation(e,b)):a==="bool"&&typeof b==="boolean"&&(d("MAWInit").MAWInit.addBoolAnnotation(e,b,c),d("MAWMIC").addBoolAnnotation(e,b))})})}var e={allowEarlyLogPoints:!0};if(a.type==="point"){if(h.has(a.data.event)){var f="worker_"+a.data.event;d("MAWInit").MAWInit.logPoint(f,e);d("MAWMIC").addPoint(f)}}else a.type==="end"&&(a.data.cancel===!0?d("MAWInit").MAWInit.logPoint("worker_creation_cancel",e):a.data.errorName!=null&&(d("MAWInit").MAWInit.addStringAnnotation("errorDescription",a.data.errorName,{allowEarlyAnnotations:!0}),d("MAWInit").MAWInit.logPoint("worker_creation_fail",e)))}g.logWorkerError=a;g.setImportScriptsErrorListener=b;g.logSharedWorkerQPLEvents=e}),98);
__d("SharedWorkerDevChangeManager",["gkx"],(function(a,b,c,d,e,f,g){"use strict";var h=!1,i=new Set();function a(a,b){var c=b.storageWorkerResource;b=b.tabResource;if(!h)return!0;if(i.has(a))return!0;if(new URLSearchParams(window.location.search).has("force_shared_worker_updates"))return!1;if(c.version===2&&b.version===2&&c.sandboxOnlyChecksum!=null)return c.sandboxOnlyChecksum===b.sandboxOnlyChecksum;return c.version===2&&c.rsrcBundleUrl==null||b.version===2&&b.getJSModuleBundleResource().url==null?!1:c.rsrcBundleUrl===b.getJSModuleBundleResource().url}function b(a){if(!h)return!1;if(i.has(a))return!1;return new URLSearchParams(window.location.search).has("force_shared_worker_updates")?!0:!1}function c(a){h&&i.add(a)}g.shouldUseStorageWorkerForDev=a;g.shouldUpgradeWorkerForDevExperimental=b;g.trackCreatedWorker=c}),98);
__d("SharedWorkerEventManager",["FBLogger"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){var d=function(a){var d;if(typeof a.data==="object"&&((d=a.data)==null?void 0:d.type)==="console"&&typeof ((d=a.data)==null?void 0:d.response)==="object"&&((d=a.data)==null?void 0:d.response)!=null){d=a.data.response;a=d.method;d=d.args;if(typeof a!=="string"||!["log","error","info","debug","warn"].includes(a)){c("FBLogger")("worker").mustfix("Unexpected console method: %s",String(a));return}if(!Array.isArray(d)){c("FBLogger")("worker").mustfix('Expected console args "%s" to be an array',JSON.stringify(d));return}b({method:a,args:d})}};a.port.addEventListener("message",d);return function(){return a.port.removeEventListener("message",d)}}function i(a,b){var c=function(a){var c;if(typeof a.data==="object"&&((c=a.data)==null?void 0:c.type)==="sw-uncaught-error"){a=typeof ((c=a.data)==null?void 0:c.e)==="object"?(c=a.data.e)!=null?c:{}:{};c=a.error;var d=a.lineno,e=a.colno,f=a.filename;a=a.message;b({error:c instanceof Error?c:null,errorObject:{lineno:typeof d==="number"?d:null,colno:typeof e==="number"?e:null,filename:typeof f==="string"?f:null,message:typeof a==="string"?a:null}})}};a.port.addEventListener("message",c);return function(){return a.port.removeEventListener("message",c)}}function a(a,b,d){var e=function(a){var e;if(typeof a.data==="object"&&((e=a.data)==null?void 0:e.type)==="sw-get-rev"&&typeof a.data.response==="object"){b==null?void 0:b.markPoint("get_worker_rev_ack_received");a=typeof a.data==="object"&&typeof ((e=a.data)==null?void 0:e.response)==="object"?(e=a.data)==null?void 0:e.response:{};e=a==null?void 0:a.workerRevision;var f=a==null?void 0:a.spinTime;a=a==null?void 0:a.workerChecksum;if(e==null||typeof e!=="number"){b==null?void 0:b.addAnnotations({string:{malformedData:"rev is non-number"}});c("FBLogger")("worker").mustfix("Expected worker rev to be non-null number, but instead received: %s",String(e));return}if(f==null||typeof f!=="number"){b==null?void 0:b.addAnnotations({string:{malformedData:"spin_time is non-number"}});c("FBLogger")("worker").mustfix("Expected worker spin time to be non-null number, but instead received: %s",String(f));return}d({rev:e,spinTime:f,workerChecksum:typeof a==="string"?a:void 0})}};a.port.addEventListener("message",e);return function(){return a.port.removeEventListener("message",e)}}function b(a,b,c){var d=function d(e){var f;if(typeof e.data==="object"&&((f=e.data)==null?void 0:f.type)==="sw-shutdown"&&typeof e.data.response==="object"){var g,h;f=typeof ((f=e.data.response)==null?void 0:f.reason)==="string"?(f=e.data.response)==null?void 0:f.reason:null;g=typeof ((g=e.data.response)==null?void 0:g.workerID)==="string"?(g=e.data.response)==null?void 0:g.workerID:null;e=typeof ((h=e.data.response)==null?void 0:h.isInitialized)==="boolean"?(h=e.data.response)==null?void 0:h.isInitialized:null;b({reason:f,workerID:g,isInitialized:e});(c==null?void 0:c.once)===!0&&a.port.removeEventListener("message",d)}};a.port.addEventListener("message",d);return function(){return a.port.removeEventListener("message",d)}}function d(a,b){a.port.addEventListener("message",function(a){var c;typeof a.data==="object"&&((c=a.data)==null?void 0:c.type)==="sw-uptime-tracking"&&typeof ((c=a.data)==null?void 0:c.response)==="object"&&typeof ((c=a.data)==null?void 0:(c=c.response)==null?void 0:c.trackerID)==="number"&&b({trackerID:a.data.response.trackerID})})}function e(a,b,d){var e=function(a){var e;if(typeof a.data==="object"&&((e=a.data)==null?void 0:e.type)==="execute-worker-ack"&&typeof ((e=a.data)==null?void 0:e.response)==="object"){e=typeof a.data==="object"&&typeof ((e=a.data)==null?void 0:e.response)==="object"?(a=(e=a.data)==null?void 0:e.response)!=null?a:{}:{};a=e.workerRevision;var f=e.spinMode,g=e.spinTime,h=e.firstInit,i=e.errorGettingSiteData;e=e.error;if(typeof h!=="boolean"){b==null?void 0:b.addAnnotations({string:{malformedData:"firstInit is non-boolean"}});c("FBLogger")("worker").mustfix("Expected firstInit to be a boolean, but instead received: %s",String(h));return}i=(i=i)!=null?i:e;if(typeof i==="string")return d({err:i,isFirstInit:h});if(typeof a==="number"&&typeof f==="number"&&typeof g==="number")return d({workerRev:a,workerSpinTime:g,workerSpinMode:f,isFirstInit:h});else b==null?void 0:b.addAnnotations({string:{malformedData:"workerRevision, spinMode, and/or spinTime are non-numbers"}}),c("FBLogger")("worker").mustfix("Expected workerRevision, spinMode, and spinTime to be non-null number, but instead received: %s %s %s",String(a),String(f),String(g))}};a.port.addEventListener("message",e);return function(){return a.port.removeEventListener("message",e)}}function f(a,b,d,e){var f=function f(g){var h;if(typeof g.data==="object"&&((h=g.data)==null?void 0:h.type)==="execute-worker-imports"&&typeof ((h=g.data)==null?void 0:h.response)==="object"){(e==null?void 0:e.once)===!0&&a.port.removeEventListener("message",f);b==null?void 0:b.markPoint("bundle_imports_ack");h=typeof g.data==="object"&&typeof ((h=g.data)==null?void 0:h.response)==="object"?(g=(h=g.data)==null?void 0:h.response)!=null?g:{}:{};g=h.err;h=h.attempts;if(g!=null&&typeof g!=="string"){b==null?void 0:b.addAnnotations({string:{malformedData:"err is neither null or a string"}});c("FBLogger")("worker").mustfix("Expected err to be null or a string, but instead receieved: %s",String(g));return}if(h!=null&&typeof h!=="number"){b==null?void 0:b.addAnnotations({string:{malformedData:"attempts is neither null or a number"}});c("FBLogger")("worker").mustfix("Expected attempts to be a number or null, but instead receieved: %s",String(h));return}d({err:g,attempts:h})}};a.port.addEventListener("message",f);return function(){return a.port.removeEventListener("message",f)}}function j(a,b,d){a.port.addEventListener("message",function(a){var e;if(typeof a.data==="object"&&((e=a.data)==null?void 0:e.type)==="ww-hrp-init"){b==null?void 0:b.markEventEnd("hrp_init");e=typeof a.data==="object"&&typeof ((e=a.data)==null?void 0:e.response)==="object"?(a=(e=a.data)==null?void 0:e.response)!=null?a:{}:{};a=e.err;if(a!=null&&typeof a!=="string"){b==null?void 0:b.addAnnotations({string:{malformedData:"err is neither null or a string"}});c("FBLogger")("worker").mustfix("Expected err to be null or a string, but instead receieved: %s",String(a));return}d({err:a})}})}function k(a,b){var c=function(a){var c;if(typeof a.data==="object"&&((c=a.data)==null?void 0:c.type)==="worker-init-mark"&&typeof ((c=a.data)==null?void 0:c.response)==="object"&&typeof ((c=a.data)==null?void 0:(c=c.response)==null?void 0:c.point)==="string"){b((c=a.data)==null?void 0:(a=c.response)==null?void 0:a.point)}};a.port.addEventListener("message",c);return function(){return a.port.removeEventListener("message",c)}}function l(a,b,c){var d=function d(e){var f;if(typeof e.data==="object"&&((f=e.data)==null?void 0:f.type)==="self-terminate"&&typeof ((f=e.data)==null?void 0:f.response)==="object"&&typeof ((f=e.data)==null?void 0:(f=f.response)==null?void 0:f.from)==="string"){var g,h,i;f=(f=e.data)==null?void 0:(f=f.response)==null?void 0:f.from;g=typeof ((g=e.data)==null?void 0:(g=g.response)==null?void 0:g.reason)==="string"?(g=e.data)==null?void 0:(g=g.response)==null?void 0:g.reason:"unknown";h=typeof ((h=e.data)==null?void 0:(h=h.response)==null?void 0:h.workerID)==="string"?(h=e.data)==null?void 0:(h=h.response)==null?void 0:h.workerID:"unknown";i=typeof ((i=e.data)==null?void 0:(i=i.response)==null?void 0:i.error)==="string"?(i=e.data)==null?void 0:(e=i.response)==null?void 0:e.error:void 0;(c==null?void 0:c.once)===!0&&a.port.removeEventListener("message",d);b(f,g,h,i)}};a.port.addEventListener("message",d);return function(){return a.port.removeEventListener("message",d)}}function m(a,b){b=(b=b)!=null?b:{};var c=b.reason;b=b.upgrade;a.port.postMessage({type:"sw-shutdown",args:[{reason:c,upgrade:b}]})}function n(a){a.port.postMessage({type:"sw-get-rev",args:[]})}function o(a,b){b=(b=b)!=null?b:{};var c=b.jsModuleResource;b=b.isDev;a.port.postMessage({type:"execute-worker",args:[(a=c)!=null?a:{},b]})}function p(a,b,c){var d=function d(e){var f;if(typeof e.data==="object"&&((f=e.data)==null?void 0:f.type)==="connection-ack"&&typeof ((f=e.data)==null?void 0:f.response)==="object"&&typeof ((f=e.data)==null?void 0:(f=f.response)==null?void 0:f.from)==="string"){f=typeof ((f=e.data)==null?void 0:(f=f.response)==null?void 0:f.workerID)==="string"?(f=e.data)==null?void 0:(f=f.response)==null?void 0:f.workerID:void 0;b((e=e.data)==null?void 0:(e=e.response)==null?void 0:e.from,f);(c==null?void 0:c.once)===!0&&a.port.removeEventListener("message",d)}};a.port.addEventListener("message",d);return function(){return a.port.removeEventListener("message",d)}}function q(a,b){var c=function(a){b(a.data)};a.port.addEventListener("message",c);return function(){return a.port.removeEventListener("message",c)}}function r(a,b){a.port.postMessage({type:"ww-connection-ack"}),b==null?void 0:b.markPoint("worker_connection_ack_requested")}function s(a,b,c){c=b.isDev;var d=b.hrp;b=b.js_env;a.port.postMessage({type:"ww-hrp-init",hrp:d,is_dev:c,js_env:b,tiered:!0})}function t(a,b){b=b.trackerID;a.port.postMessage({type:"sw-uptime-tracking",args:{trackerID:b}})}function u(a){var b=h(a,function(a){var b,c=a.args;a=a.method;(b=console)[a].apply(b,c)}),d=i(a,function(a){var b=a.error;a=a.errorObject;b!=null?c("FBLogger")("worker").catching(b).mustfix("Shared Worker uncaught error."):c("FBLogger")("worker").mustfix("Shared Worker uncaught error with no Error object. %s:%d:%d:%s",a.message,a.lineno,a.colno,a.filename)});return function(){b(),d()}}g.registerLogFowardingListener=h;g.registerUncaughtErrorForwardingListener=i;g.registerGetWorkerRevListener=a;g.registerWorkerShutdownListener=b;g.registerUptimeTrackerListener=d;g.registerExecuteWorkerAckListener=e;g.registerExecuteWorkerImportsListener=f;g.registerHrpInitListener=j;g.registerWorkerInitPointsListener=k;g.registerWorkerSelfTerminationListener=l;g.emitWorkerShutdown=m;g.emitGetRev=n;g.emitExecuteWorker=o;g.registerConnectionAckListener=p;g.registerAnyMessageListener=q;g.emitConnectionAckRequest=r;g.emitHrpInit=s;g.emitUptimeTracking=t;g.registerForwardListeners=u}),98);
__d("supportsNativeWebLock",[],(function(a,b,c,d,e,f){"use strict";function a(){return self.LockManager!=null&&self.navigator.locks instanceof self.LockManager}f["default"]=a}),66);
__d("SharedWorkerLockManager",["Deferred","FBLogger","WebStorageLockManager","emptyFunction","pageID","promiseDone","setTimeout","supportsNativeWebLock"],(function(a,b,c,d,e,f,g){"use strict";var h="shared_worker_mutex",i=6e5;function j(a){var b;b=(b=window)==null?void 0:(b=b.navigator)==null?void 0:b.locks;if(b!=null)return b;var e=d("WebStorageLockManager").make(c("pageID"));if(e!=null){a==null?void 0:a.addAnnotations({bool:{fallback_lock_manager:!0}});return{request:function(a,b){return e.request(a,b)}}}return null}function k(a,b,d){c("setTimeout")(function(){a.isSettled()||(b==null?void 0:b.endFailure("lock_timeout"),c("FBLogger")("worker").warn("[SharedWorkerLockManager]: lock timed out in %s ms",i),a.resolve(),d==null?void 0:d())},i)}function a(a,b){var d=b.workerQPLLogger,e=b.onLockTimeout;b=b.onLockFail;var f=j(d);d==null?void 0:d.addAnnotations({bool:{native_locks:f!=null?c("supportsNativeWebLock")():null}});if(f==null){d==null?void 0:d.markPoint("no_lock_manager");c("FBLogger")("worker").warn("Unable to initialize lock manager");a(c("emptyFunction"));return}d==null?void 0:d.markPoint("lock_requested");var g=new(c("Deferred"))();c("promiseDone")(f.request(h,function(){d==null?void 0:d.markPoint("lock_obtained");k(g,d,e);a(function(){d==null?void 0:d.markPoint("lock_released"),g.resolve()});return g.getPromise()}),void 0,b)}g.withWorkerLock=a}),98);
__d("SharedWorkerLoggingUtils",["ErrorSerializer","FBLogger","ODS","QPLUserFlow","getErrorSafe","pageID","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c,e){(h||(h=d("ODS"))).bumpEntityKey(6653,"shared_worker_infra","worker_self_termination."+b+"."+a),i(a,b,c,e,!0)}function i(a,b,d,e,f){f===void 0&&(f=!1);var g=c("qpl")._(931600201,"1438");c("QPLUserFlow").start(g);c("QPLUserFlow").endSuccess(g,{annotations:{string:{workerName:a,workerID:e,reason:d,location:b,pageID:c("pageID")},bool:{isSelfTermination:f}}})}function b(a,b,c,d,e,f){a==null?void 0:a.markEventEnd("execute_worker"),a==null?void 0:a.addAnnotations({"int":{runningWorkerRev:e,runningWorkerSpinTime:b,runningWorkerSpinMode:f},string:{executeWorkerErr:c},bool:{isFirstInit:d}})}function e(a,b,d){var e;e=c("getErrorSafe")((e=b instanceof ErrorEvent&&(b==null?void 0:b.error))!=null?e:b);c("FBLogger")("worker").catching(e).warn("Worker %s onerror: %s type, %s message",d,String(b.type),c("ErrorSerializer").toReadableMessage(e));a==null?void 0:a.addAnnotations({string_array:{onErrorHandler:[(a=JSON.stringify((d=e==null?void 0:e.message)!=null?d:b==null?void 0:b.message))!=null?a:"undefined",String((d=b==null?void 0:b.lineno)!=null?d:e==null?void 0:e.lineno),String((a=b==null?void 0:b.colno)!=null?a:e==null?void 0:e.colno),String((d=b==null?void 0:b.filename)!=null?d:e==null?void 0:e.filename)]}})}g.logSelfTermination=a;g.logShutdown=i;g.logExecuteAck=b;g.logSharedWorkerError=e}),98);
__d("validateSharedWorkerReference",["ConstUriUtils","isRelativeURL","isSameOrigin","memoize"],(function(a,b,c,d,e,f,g){"use strict";var h=c("memoize")(function(){return d("ConstUriUtils").getUri(window.location.href)});function i(a){var b=h(),e=d("ConstUriUtils").getUri(a);e=b!=null&&e!=null?c("isSameOrigin")(e,b):!1;return e||c("isRelativeURL")(a)}function a(a){if(a==null||typeof a!=="object")return null;var b=a.rev,c=a.spin_time,d=a.url,e=a.version,f=a.rsrcBundleUrl;a=a.sandboxOnlyChecksum;return typeof b!=="number"||typeof c!=="number"||e!=null&&e!==1&&e!==2||!Number.isInteger(b)||!Number.isInteger(c)||typeof d!=="string"||!i(d)||f!=null&&typeof f!=="string"||a!=null&&typeof a!=="string"?null:{rev:b,spin_time:c,url:d,version:(b=e)!=null?b:1,rsrcBundleUrl:f,sandboxOnlyChecksum:a}}g["default"]=a}),98);
__d("SharedWorkerStorageManager",["Deferred","FBLogger","Promise","WebAsyncStorage","gkx","validateSharedWorkerReference"],(function(a,b,c,d,e,f,g){"use strict";var h,i="__swbundle__",j={};function k(a){return""+i+a}function l(a){var b=new(c("Deferred"))();c("WebAsyncStorage").removeItem(k(a),function(c){if(c)return b.reject(c);j[a]=null;b.resolve()});return b.getPromise()}function m(a,b){var d=new(c("Deferred"))();c("WebAsyncStorage").setItem(k(a),b,function(c){if(c!=null)return d.reject(c);j[a]=b;d.resolve()});return d.getPromise()}function n(a){var b=new(c("Deferred"))();c("WebAsyncStorage").getItem(k(a),function(c,d){if(c)return b.reject(c);j[a]=d;b.resolve(d)});return b.getPromise()}function a(){return j}function d(a,b){return n(a).then(function(a){a=c("validateSharedWorkerReference")(a);return a==null?null:a})["catch"](function(d){c("FBLogger")("worker").catching(d).mustfix("Failed to getSharedWorkerReference for bundleName %s",a);var e=c("gkx")("12225");b==null?void 0:b.addAnnotations({bool:{failedToGetSharedWorkerResource:!0,suppressStorageError:e}});if(!e)throw d})}function e(a,b){return l(a)["catch"](function(d){c("FBLogger")("worker").catching(d).mustfix("Failed to removeSharedWorkerReference for bundleName %s",a);var e=c("gkx")("12225");b==null?void 0:b.addAnnotations({bool:{failedToDeleteSharedWorkerResource:!0,suppressStorageError:e}});if(!e)throw d})}function f(a,d,e){var f=c("validateSharedWorkerReference")(d);if(f==null){c("FBLogger")("worker").mustfix('Failed to save worker reference for bundle "%s". Invalid reference: %s',a,JSON.stringify(d));return(h||(h=b("Promise"))).resolve()}return m(a,f)["catch"](function(b){c("FBLogger")("worker").catching(b).mustfix("Failed to saveSharedWorkerReference for bundleName %s",a);var d=c("gkx")("12225");e==null?void 0:e.addAnnotations({bool:{failedToSaveSharedWorkerResource:!0,suppressStorageError:d}});if(!d)throw b})}g.SHARED_WORKER_STORAGE_KEY_BASE=i;g.getDebugState=a;g.getSharedWorkerReference=d;g.removeSharedWorkerReference=e;g.saveSharedWorkerReference=f}),98);
__d("XCometFBMultiSiteWebWorkerV2InitScriptControllerRouteBuilder",["jsRouteBuilder"],(function(a,b,c,d,e,f,g){a=c("jsRouteBuilder")("/static_resources/webworker/init_script/",Object.freeze({}),void 0);b=a;g["default"]=b}),98);
__d("supportsModuleWorker",["UserAgent"],(function(a,b,c,d,e,f,g){"use strict";var h=null;function a(a){if(h!=null)return h;if(h!=null)return h;if(c("UserAgent").isEngine("Blink")){h=a?c("UserAgent").isEngine_DEPRECATED_DANGEROUS("Blink > 83"):c("UserAgent").isEngine_DEPRECATED_DANGEROUS("Blink > 80.1");return h}if(c("UserAgent").isBrowser("Safari")){h=c("UserAgent").isBrowser("Safari > 14.9");return h}if(c("UserAgent").isBrowser("Firefox")){h=c("UserAgent").isBrowser("Firefox > 113");return h}if(c("UserAgent").isEngine("WebKit")){h=c("UserAgent").isEngine_DEPRECATED_DANGEROUS("WebKit > 606");return h}if(c("UserAgent").isBrowser("IE")){h=!1;return h}var b={get type(){h=!0}};try{a?new SharedWorker("blob://",b):new Worker("blob://",b)}finally{h=(a=h)!=null?a:!1;return h}}g["default"]=a}),98);
__d("createSharedWorkerV2BundleUrlExperimental",["XCometFBMultiSiteWebWorkerV2InitScriptControllerRouteBuilder","nullthrows","supportsModuleWorker"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=c("supportsModuleWorker")(!0);return c("nullthrows")((b=c("XCometFBMultiSiteWebWorkerV2InitScriptControllerRouteBuilder").buildUri({worker_type:b?"MODULE":"CLASSIC",name:a}))==null?void 0:b.toString())}g["default"]=a}),98);
__d("SharedWorkerMigrationUtils",["ConstUriUtils","Deferred","FBLogger","Promise","SharedWorkerEventManager","SharedWorkerStatusLock","SharedWorkerStorageManager","TrustedTypesWebWorkerScriptURLPolicy","asyncToGeneratorRuntime","clearTimeout","createSharedWorkerV2BundleUrlExperimental","err","justknobx","setTimeout","supportsModuleWorker","supportsNativeWebLock"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(!c("supportsNativeWebLock")())return!0;var b=(yield self.navigator.locks.query());return b.held.some(function(b){return b.name===d("SharedWorkerStatusLock").getDynamicStringInitLockName(a)})});return j.apply(this,arguments)}function k(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(!c("supportsNativeWebLock")())return!0;var b=(yield self.navigator.locks.query());return b.held.some(function(b){return b.name===d("SharedWorkerStatusLock").getStatusLockName(a)})});return l.apply(this,arguments)}var m={SharedWorkerBundle:c("justknobx")._("2852"),MAWMainWebWorkerV2Bundle:c("justknobx")._("2920")};function a(a){return(a=m[a])!=null?a:!1}function e(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(!(yield i(a)))return!1;var b=new(c("Deferred"))(),e=c("createSharedWorkerV2BundleUrlExperimental")(a);e=c("TrustedTypesWebWorkerScriptURLPolicy").createScriptURL(e);e=c("supportsModuleWorker")(!0)?new SharedWorker(e,{name:a,type:"module"}):new SharedWorker(e,a);d("SharedWorkerEventManager").registerWorkerShutdownListener(e,function(a){b.resolve(!0)},{once:!0});d("SharedWorkerEventManager").emitWorkerShutdown(e,{upgrade:!1,reason:"dynamic_string_worker_rollback"});e.port.start();return b.getPromise()});return n.apply(this,arguments)}function o(a){a=d("ConstUriUtils").getUri(a);return a!=null&&a.getQueryParam("hash")!=null}function f(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.name,f=a.logger;try{a=(yield (h||(h=b("Promise"))).all([k(e),i(e)]));var g=a[0];a=a[1];if(!g||c("supportsNativeWebLock")()&&a){f.markPoint("legacy_termination_skipped");f.addAnnotations({bool:{dynamicStringWorkerAlreadyRunning:a,workerAlreadyRunning:g,native_locks:c("supportsNativeWebLock")()}});return}a=(yield d("SharedWorkerStorageManager").getSharedWorkerReference(e));f.markPoint("storage_read");f.addAnnotations({bool:{storageResourceSet:a!=null}});if(a==null)return;try{yield d("SharedWorkerStorageManager").removeSharedWorkerReference(e),f.markPoint("storage_cleaned")}catch(a){f.markPoint("storage_error"),f.addAnnotations({string:{storageError:a.toString()}}),c("FBLogger")("worker").catching(a).mustfix("Failed to remove reference from storage.")}g=o(a.url);f.markPoint(g?"legacy_termination_start":"termination_skipped");if(g){var j=new(c("Deferred"))();g=c("TrustedTypesWebWorkerScriptURLPolicy").createScriptURL(a.url);a=c("supportsModuleWorker")(!0)?new SharedWorker(g,{name:e,type:"module"}):new SharedWorker(g,e);g=function(){f.markPoint("legacy_termination_end"),j.resolve(!0)};d("SharedWorkerEventManager").registerWorkerShutdownListener(a,g,{once:!0});d("SharedWorkerEventManager").registerWorkerSelfTerminationListener(a,g,{once:!0});a.port.start();d("SharedWorkerEventManager").emitWorkerShutdown(a,{upgrade:!1,reason:"maw-request-refresh"});e=c("setTimeout")(function(){f.markPoint("legacy_termination_timeout"),j.reject(c("err")("Failed to close Shared Web Worker properly. SelfTerminationTimeout was exceeded."))},1e3);yield j.getPromise();c("clearTimeout")(e)}}catch(a){f.markPoint("legacy_check_and_termination_error"),f.addAnnotations({string:{legacyCheckError:a.toString()}}),c("FBLogger")("worker").catching(a).mustfix("Failed to check storage and possibly terminate legacy worker.")}});return p.apply(this,arguments)}g.isDynamicStringWorkerRunning=i;g.isStatusLockHeld=k;g.shouldCheckForDynamicStringWorker=a;g.maybeTerminateDynamicStringWorker=e;g.isLegacyWorkerURL=o;g.checkStorageAndTerminateLegacyWorker=f}),98);
__d("SharedWorkerUptimeTracker",["FBLogger","ODS","SharedWorkerEventManager","clearInterval","performanceNow","setInterval","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=1e4,k=45e3,l=new Map();function m(a){return Math.floor(((i||(i=c("performanceNow")))()-a)/1e3)}function n(a,b){var e=0,f={};d("SharedWorkerEventManager").registerUptimeTrackerListener(a,function(a){a=a.trackerID;var c=f[a];if(c==null)return;(h||(h=d("ODS"))).bumpFraction(6653,"shared_worker_infra","worker_uptime."+b,1,0);h.bumpEntityKey(6653,"shared_worker_infra","worker_uptime_elapsed_time_to_response_sec."+m(c.createdMs)+"."+b);delete f[a]});return c("setInterval")(function(){var g=e++;c("setTimeout")(function(){var a=f[g];if(a==null)return;delete f[g]},k);f[g]={createdMs:(i||(i=c("performanceNow")))()};(h||(h=d("ODS"))).bumpFraction(6653,"shared_worker_infra","worker_uptime."+b,0,1);d("SharedWorkerEventManager").emitUptimeTracking(a,{trackerID:g})},j)}function a(a,b){if(l.has(b)){c("FBLogger")("worker").mustfix('Uptime tracking for worker "%s" already started.',b);return}l.set(b,{intervalID:n(a,b)})}function b(a){var b=l.get(a);b!=null&&(c("clearInterval")(b.intervalID),l["delete"](a))}g.startUptimeTracking=a;g.stopUptimeTracking=b}),98);
__d("XCometFBMultiSiteWebWorkerV2HasteResponseControllerRouteBuilder",["jsRouteBuilder"],(function(a,b,c,d,e,f,g){a=c("jsRouteBuilder")("/static_resources/webworker/rsrc/",Object.freeze({}),void 0);b=a;g["default"]=b}),98);
__d("WebWorkerV2DynamicData",["Promise","XCometFBMultiSiteWebWorkerV2HasteResponseControllerRouteBuilder","cometAsyncFetchShared","err","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new Map();function a(a){var b=a.name,c=i.get(b);c==null&&(c=j(a),i.set(b,c));return c}function j(a){var d=a.name,e=a.v2HasteResponsePreloader;if(e==null)return k(d);var f=null;a=new(h||(h=b("Promise")))(function(a,b){e.onLoaded(function(b){b=b.data;f=b;a(b)}).onError(b)});return h.race([a,new h(function(a,b){window.setTimeout(function(){f==null?c("promiseDone")(k(d),a,b):a(f)},1e4)})])}function k(a){return c("cometAsyncFetchShared")(c("XCometFBMultiSiteWebWorkerV2HasteResponseControllerRouteBuilder").buildUri({worker_module:a}).toString(),{data:{},getFullPayload:!0,method:"POST",skipSRState:!0}).then(function(b){if(b!=null&&typeof b==="object"&&Object.prototype.hasOwnProperty.call(b,"hrp")&&typeof b.hrp==="object")return b;throw c("err")("Unexpected data from WorkerInitResourceDeliveryController for worker %s",a)})}g.readDynamicDataForWorker=a}),98);
__d("checkForIndexedDbSupported",[],(function(a,b,c,d,e,f){"use strict";function a(){return!window.indexedDB?!1:!0}f["default"]=a}),66);
__d("buildSharedWorkerInitQPLLogger",["QPLUserFlow","SiteData","checkForIndexedDbSupported","pageID","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=c("qpl")._(931595918,"2062"),i=0;function a(a){var b=!1,d=!1,e=i++;function f(f){var g=f.version,i=f.workerName,j=f.callReason,k=f.experimental_init;f=f.migrationEnabled;if(b||d)return;b=!0;g={"int":{version:g,clientRev:c("SiteData").client_revision},bool:{isDev:!1,supportsIDB:c("checkForIndexedDbSupported")(),experimental_init:(g=k)!=null?g:!1,migrationEnabled:(k=f)!=null?k:!1},string:{workerName:i,hostname:window.location.hostname,callReason:j,pageID:c("pageID")}};c("QPLUserFlow").start(h,{onFlowTimeout:function(){c("QPLUserFlow").addAnnotations(h,{bool:{setupTimeout:!0}},{instanceKey:e}),d=!0},cancelOnUnload:!0,annotations:g,timeoutInMs:66e4,instanceKey:e});a==null?void 0:a({type:"start",data:{annotations:g}})}function g(f,g){f=f+"_start";a==null?void 0:a({type:"point",data:{annotations:g,event:f}});if(!b||d)return;c("QPLUserFlow").addPoint(h,f,{data:g,instanceKey:e})}function j(f,g){f=f+"_end";a==null?void 0:a({type:"point",data:{annotations:g,event:f}});if(!b||d)return;c("QPLUserFlow").addPoint(h,f,{data:g,instanceKey:e});a==null?void 0:a({type:"point",data:{annotations:g,event:f}})}function k(f,g){a==null?void 0:a({type:"point",data:{annotations:g,event:f}});if(!b||d)return;c("QPLUserFlow").addPoint(h,f,{data:g,instanceKey:e})}function l(f){a==null?void 0:a({type:"end",data:{annotations:f}});if(!b||d)return;c("QPLUserFlow").endSuccess(h,{annotations:f,instanceKey:e});d=!0}function m(f,g){a==null?void 0:a({type:"end",data:{errorName:f,annotations:g}});if(!b||d)return;c("QPLUserFlow").endFailure(h,f,{annotations:g,instanceKey:e});d=!0}function n(f){a==null?void 0:a({type:"end",data:{annotations:f,cancel:!0}});if(!b||d)return;c("QPLUserFlow").endCancel(h,{annotations:f,instanceKey:e});d=!0}function o(f){a==null?void 0:a({type:"annotate",data:{annotations:f}});if(!b||d)return;c("QPLUserFlow").addAnnotations(h,f,{instanceKey:e})}return{start:f,endFailure:m,addAnnotations:o,endSuccess:l,endCancel:n,markEventStart:g,markEventEnd:j,markPoint:k}}g["default"]=a}),98);
__d("buildSharedWorkerTerminateQPLLogger",["QPLUserFlow","SiteData","pageID","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=c("qpl")._(931600201,"1438"),i=0;function a(a){var b=!1,d=!1,e=i++;function f(f){var g=f.workerName;f=f.callReason;if(b||d)return;b=!0;g={"int":{clientRev:c("SiteData").client_revision},bool:{isDev:!1},string:{workerName:g,hostname:window.location.hostname,callReason:f,pageID:c("pageID")}};c("QPLUserFlow").start(h,{onFlowTimeout:function(){c("QPLUserFlow").addAnnotations(h,{bool:{setupTimeout:!0}},{instanceKey:e}),d=!0},cancelOnUnload:!0,annotations:g,timeoutInMs:3e4,instanceKey:e});a==null?void 0:a({type:"start",data:{annotations:g}})}function g(f,g){if(!b||d)return;f=f+"_start";c("QPLUserFlow").addPoint(h,f,{data:g,instanceKey:e});a==null?void 0:a({type:"point",data:{annotations:g,event:f}})}function j(f,g){if(!b||d)return;f=f+"_end";c("QPLUserFlow").addPoint(h,f,{data:g,instanceKey:e});a==null?void 0:a({type:"point",data:{annotations:g,event:f}})}function k(f,g){if(!b||d)return;c("QPLUserFlow").addPoint(h,f,{data:g,instanceKey:e});a==null?void 0:a({type:"point",data:{annotations:g,event:f}})}function l(f){if(!b||d)return;c("QPLUserFlow").endSuccess(h,{annotations:f,instanceKey:e});a==null?void 0:a({type:"end",data:{annotations:f}});d=!0}function m(f,g){if(!b||d)return;c("QPLUserFlow").endFailure(h,f,{annotations:g,instanceKey:e});a==null?void 0:a({type:"end",data:{errorName:f,annotations:g}});d=!0}function n(f){if(!b||d)return;c("QPLUserFlow").endCancel(h,{annotations:f,instanceKey:e});a==null?void 0:a({type:"end",data:{annotations:f,cancel:!0}});d=!0}function o(f){if(!b||d)return;c("QPLUserFlow").addAnnotations(h,f,{instanceKey:e});a==null?void 0:a({type:"annotate",data:{annotations:f}})}return{start:f,endFailure:m,addAnnotations:o,endSuccess:l,endCancel:n,markEventStart:g,markEventEnd:j,markPoint:k}}g["default"]=a}),98);
__d("XCometFBMultiSiteSharedWorkerStaticInitScriptControllerRouteBuilder",["jsRouteBuilder"],(function(a,b,c,d,e,f,g){a=c("jsRouteBuilder")("/static_resources/sharedworker/init_script/",Object.freeze({}),void 0);b=a;g["default"]=b}),98);
__d("getSharedWorkerHash",["uuidv4"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("uuidv4")()}g["default"]=a}),98);
__d("createSharedWorkerBundleUrl",["XCometFBMultiSiteSharedWorkerStaticInitScriptControllerRouteBuilder","getSharedWorkerHash","getWorkerInitScriptSPINParams","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a;return c("nullthrows")((a=c("XCometFBMultiSiteSharedWorkerStaticInitScriptControllerRouteBuilder").buildUri({hash:c("getSharedWorkerHash")()}).addQueryParams(c("getWorkerInitScriptSPINParams")()))==null?void 0:a.toString())}g["default"]=a}),98);
__d("createSharedWorkerV2BundleUrl",["XCometFBMultiSiteWebWorkerV2InitScriptControllerRouteBuilder","getSharedWorkerHash","getWorkerInitScriptSPINParams","nullthrows","supportsModuleWorker"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a=c("supportsModuleWorker")(!0),b=c("getWorkerInitScriptSPINParams")();b.set("hash",c("getSharedWorkerHash")());return c("nullthrows")((a=c("XCometFBMultiSiteWebWorkerV2InitScriptControllerRouteBuilder").buildUri({worker_type:a?"MODULE":"CLASSIC"}))==null?void 0:(a=a.addQueryParams(b))==null?void 0:a.toString())}g["default"]=a}),98);
__d("handleWorkerWriteError",["FBLogger","WebStorageCleanupReason"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if(a instanceof Error){c("FBLogger")("worker").catching(a).mustfix("Error occured checking in shared worker reference");return}if(a==="writes disabled"){var b;c("FBLogger")("worker").warn("Writes to WebAsyncStorage is disabled. Unable to save shared worker reference. Reason: %s",(b=d("WebStorageCleanupReason").getLastCleanupReason())!=null?b:"n/a");return}c("FBLogger")("worker").mustfix("Error occured checking in shared worker reference: %s",JSON.stringify(a))}g["default"]=a}),98);
__d("SharedWorkerInitFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("4266");b=d("FalcoLoggerInternal").create("shared_worker_init",a);e=b;g["default"]=e}),98);
__d("logSharedWorkerInitStep",["SharedWorkerInitFalcoEvent","SiteData","gkx","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h=c("uuidv4")();function a(a,b,d,e){if(!c("gkx")("21115"))return;c("SharedWorkerInitFalcoEvent").log(function(){return{client_id:h,bundle_name:a,client_rev:String(c("SiteData").client_revision),local_shared_worker_ref:b!=null?{bundle_url:b.url,rev:String(b.rev),spin_time:String(b.spin_time)}:null,new_shared_worker_ref:d!=null?{bundle_url:d}:null,init_step:e}})}g["default"]=a}),98);
__d("SharedWorkerBundleResource",["BootloaderPreloader","Deferred","FBLogger","Promise","SharedWorkerDevChangeManager","SharedWorkerEventManager","SharedWorkerLockManager","SharedWorkerLoggingUtils","SharedWorkerMigrationUtils","SharedWorkerStorageManager","SharedWorkerUptimeTracker","SharedWorkerV2ResourceExperimental","SiteData","StaticSiteData","TrustedTypesWebWorkerScriptURLPolicy","WebWorkerV2DynamicData","asyncToGeneratorRuntime","buildSharedWorkerInitQPLLogger","buildSharedWorkerTerminateQPLLogger","clearTimeout","createSharedWorkerBundleUrl","createSharedWorkerV2BundleUrl","createSharedWorkerV2BundleUrlExperimental","err","getErrorSafe","gkx","handleWorkerWriteError","justknobx","logSharedWorkerInitStep","pageID","promiseDone","setTimeout","supportsModuleWorker","supportsNativeWebLock"],(function(a,b,c,d,e,f,g){"use strict";var h,i=5e3,j=function(b){babelHelpers.inheritsLoose(a,b);function a(a){var c;c=b.call(this)||this;c.name="SelfTerminationError";c.message="Worker self terminated with the reason: "+a;c.reason=a;return c}return a}(babelHelpers.wrapNativeSuper(Error));function k(a,b,e,f){f==null?void 0:f.markEventStart("shared_worker_construct");var g=new SharedWorker(c("TrustedTypesWebWorkerScriptURLPolicy").createScriptURL(a),b);f==null?void 0:f.markEventEnd("shared_worker_construct");g.addEventListener("error",function(a){d("SharedWorkerLoggingUtils").logSharedWorkerError(f,a,b)});var h=new Set();d("SharedWorkerEventManager").registerWorkerSelfTerminationListener(g,function(a,c,e){d("SharedWorkerLoggingUtils").logSelfTermination(b,a,c,e)},{once:!0});var i=0;d("SharedWorkerEventManager").registerConnectionAckListener(g,function(a,b){i++;if(h.has("worker_connection_established")){f==null?void 0:f.addAnnotations({"int":{connectionAckNum:i}});return}h.add("worker_connection_established");f==null?void 0:f.addAnnotations({string:{connectedFrom:a,workerID:b}});f==null?void 0:f.markPoint("worker_connection_established")});d("SharedWorkerEventManager").registerWorkerInitPointsListener(g,function(a){if(h.has(a))return;h.add(a);f==null?void 0:f.markPoint("worker_init_point_"+a)});g.port.start();d("SharedWorkerEventManager").registerExecuteWorkerImportsListener(g,f,function(a){var b=a.err;a=a.attempts;f==null?void 0:f.addAnnotations({string:{importsError:b},"int":{importAttempts:a}});f==null?void 0:f.markPoint(b==null?"bundle_imports_success":"bundle_imports_failure")});var j=new(c("Deferred"))();d("SharedWorkerEventManager").registerExecuteWorkerAckListener(g,f,function(a){var b=a.workerSpinTime,e=a.err,g=a.isFirstInit,h=a.workerRev;a=a.workerSpinMode;d("SharedWorkerLoggingUtils").logExecuteAck(f,b,e,g,h,a);if(e!=null||b==null||h==null){j.reject(c("err")((g=e)!=null?g:"no worker rev or spin time"))}else j.resolve({rev:h,spinTime:b})});f==null?void 0:f.markEventStart("execute_worker");d("SharedWorkerEventManager").emitExecuteWorker(g,{jsModuleResource:e,isDev:!1});return j.getPromise().then(function(a){var b=a.rev;a=a.spinTime;return{worker:g,rev:b,spinTime:a}})}function l(a,b,c,d,e){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g){d("SharedWorkerMigrationUtils").shouldCheckForDynamicStringWorker(b)&&(f==null?void 0:f.markEventStart("dynamic_string_worker_check"),c("promiseDone")(d("SharedWorkerMigrationUtils").maybeTerminateDynamicStringWorker(b),function(a){f==null?void 0:f.markEventEnd("dynamic_string_worker_check",{bool:{didTerminateDynamicStringWorker:a}})}));g=c("TrustedTypesWebWorkerScriptURLPolicy").createScriptURL(a);var h=c("supportsModuleWorker")(!0)?new SharedWorker(g,{name:b,type:"module"}):new SharedWorker(g,b);f==null?void 0:f.markPoint("shared_worker_construct_done");f==null?void 0:f.addAnnotations({string:{workerUrl:g.toString()}});d("SharedWorkerEventManager").registerConnectionAckListener(h,function(a,b){f==null?void 0:f.addAnnotations({string:{connectedFrom:a,workerID:b}}),f==null?void 0:f.markPoint("worker_connection_established")});h.addEventListener("error",function(a){d("SharedWorkerLoggingUtils").logSharedWorkerError(f,a,b)});var i=new(c("Deferred"))();d("SharedWorkerEventManager").registerWorkerSelfTerminationListener(h,function(a,c,e,g){f==null?void 0:f.addAnnotations({string:{selfTerminationError:g}}),d("SharedWorkerLoggingUtils").logSelfTermination(b,a,c,e),i.reject(new j(c))},{once:!0});var k=new Set();d("SharedWorkerEventManager").registerWorkerInitPointsListener(h,function(a){if(k.has(a))return;k.add(a);f==null?void 0:f.markPoint("worker_init_point_"+a)});h.port.start();d("SharedWorkerEventManager").emitConnectionAckRequest(h,f);d("SharedWorkerEventManager").registerHrpInitListener(h,f,function(){});f==null?void 0:f.markPoint("read_dynamic_data");c("promiseDone")(d("WebWorkerV2DynamicData").readDynamicDataForWorker(e).then(function(a){f==null?void 0:f.markEventStart("hrp_init");try{var e=c("justknobx")._("1979");e&&d("BootloaderPreloader").preloadWorkerJSFromHRP(a.hrp);f==null?void 0:f.addAnnotations({bool:{prefetchWorkerScripts:e}})}catch(a){e=c("getErrorSafe")(a);f==null?void 0:f.addAnnotations({string:{hrpInitErr:e.toString()}});c("FBLogger")("worker").catching(a).warn("Failed to preload worker %s JS from HRP",b)}d("SharedWorkerEventManager").emitHrpInit(h,{hrp:a.hrp,js_env:a.js_env,isDev:!1},f)},function(a){a=c("getErrorSafe")(a);f==null?void 0:f.addAnnotations({string:{hrpInitErr:a.toString()}})}));d("SharedWorkerEventManager").registerExecuteWorkerAckListener(h,f,function(a){var b=a.workerSpinTime,e=a.err,g=a.isFirstInit,h=a.workerRev;a=a.workerSpinMode;d("SharedWorkerLoggingUtils").logExecuteAck(f,b,e,g,h,a);if(e!=null||h==null||b==null){i.reject(c("err")((g=e)!=null?g:"no worker rev or spin time"))}else i.resolve({rev:h,spinTime:b})});f==null?void 0:f.markEventStart("execute_worker");d("SharedWorkerEventManager").emitExecuteWorker(h);return i.getPromise().then(function(a){var b=a.rev;a=a.spinTime;return{worker:h,rev:b,spinTime:a}})});return m.apply(this,arguments)}function n(a,b,e,f,g,h){var i=new(c("Deferred"))();d("SharedWorkerEventManager").registerGetWorkerRevListener(a,h,function(a){var j=a.rev;a=a.spinTime;c("promiseDone")(d("SharedWorkerStorageManager").saveSharedWorkerReference(e,{url:b,rev:j,spin_time:a,version:g.version,rsrcBundleUrl:g.getJSModuleBundleResource().url,sandboxOnlyChecksum:g.sandboxOnlyChecksum},h).then(function(){return d("SharedWorkerStorageManager").getSharedWorkerReference(e,h)}).then(function(a){c("logSharedWorkerInitStep")(e,a,g.resourceUrlForLogging,"after_worker_reference_save")}),function(){h.markEventEnd("get_worker_rev",{bool:{successfullySavedWorkerRef:!0}}),i.resolve(),f()},function(a){h.markEventEnd("get_worker_rev",{bool:{successfullySavedWorkerRef:!1}}),i.reject(a),c("handleWorkerWriteError")(a),f()})});h.markEventStart("get_worker_rev");d("SharedWorkerEventManager").emitGetRev(a);return i.getPromise()}function o(a,b,e){d("SharedWorkerEventManager").registerForwardListeners(a),d("SharedWorkerEventManager").registerWorkerShutdownListener(a,function(a){var c=a.reason;a=a.workerID;d("SharedWorkerLoggingUtils").logShutdown(e,null,c,a);c=c==="dynamic_string_worker_rollback"?"requested-upgrade":c;b==null?void 0:b(c,a,"sw-shutdown");d("SharedWorkerUptimeTracker").stopUptimeTracking(e)}),d("SharedWorkerEventManager").registerWorkerSelfTerminationListener(a,function(a,c,f){b==null?void 0:b(c,f,"self-terminate"),d("SharedWorkerUptimeTracker").stopUptimeTracking(e)}),d("SharedWorkerDevChangeManager").trackCreatedWorker(e),d("SharedWorkerUptimeTracker").startUptimeTracking(a,e),c("logSharedWorkerInitStep")(e,null,null,"create_worker_end")}function p(a,b,c,d,e,f){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,h){h.addAnnotations({string:{initFlow:"use_existing_ref"}});c("logSharedWorkerInitStep")(a,null,null,"using_existing_worker_ref");var i=d("SharedWorkerMigrationUtils").isLegacyWorkerURL(b.url),j=(yield b.version===2?i?l(b.url,a,e.getJSModuleBundleResource(),h,e.version===2?e.withPostMessageTimeout:!1):d("SharedWorkerV2ResourceExperimental").startV2Worker(b.url,a,e.getJSModuleBundleResource(),h):k(b.url,a,e.getJSModuleBundleResource(),h));j=j.worker;f();b.version===2&&!i&&void n(j,b.url,a,f,e,h);o(j,g,a);return j});return q.apply(this,arguments)}function r(a,b,c,d,e,f,g){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,h,j){h.addAnnotations({string:{initFlow:"upgrade_worker_ref"}});var k=new(c("Deferred"))(),l=d("SharedWorkerMigrationUtils").isStatusLockHeld(a);if((yield d("SharedWorkerMigrationUtils").isDynamicStringWorkerRunning(a))&&c("supportsNativeWebLock")()&&j===!1)k.resolve(),h.addAnnotations({string:{oldWorkerShutdown:"not_needed_for_dynamic_string"}});else if(yield l){b.version===2&&c("supportsModuleWorker")(!0)?l=new SharedWorker(b.url,{name:a,type:"module"}):l=new SharedWorker(b.url,a);d("SharedWorkerEventManager").registerWorkerShutdownListener(l,function(a){var b=a.workerID,e=a.isInitialized;j?c("setTimeout")(function(){h.markEventEnd("old_worker_shutdown",{string:{oldWorkerID:b},bool:{oldWorkerWasInitialized:e}}),k.resolve()},d("SharedWorkerV2ResourceExperimental").DELAY_FOR_WORKER_SHUTDOWN_MS):(h.markEventEnd("old_worker_shutdown",{string:{oldWorkerID:b},bool:{oldWorkerWasInitialized:e}}),k.resolve());h.addAnnotations({string:{oldWorkerShutdown:"success"}})},{once:!0});h.markEventStart("old_worker_shutdown");d("SharedWorkerEventManager").emitWorkerShutdown(l,{upgrade:!0});l.port.start()}else k.resolve(),h.addAnnotations({string:{oldWorkerShutdown:"not_needed"}});if(c("gkx")("4471")){b=c("setTimeout")(function(){h.addAnnotations({string:{oldWorkerShutdown:"timeout"}}),k.reject(c("err")("Worker shutdown timeout on upgrade"))},i);yield k.getPromise();c("clearTimeout")(b)}else j===!0?yield k.getPromise():k.resolve();return u(a,e,f,g,h,"upgrading_worker_ref")});return s.apply(this,arguments)}function t(a,b,c,d,e){e.addAnnotations({string:{initFlow:"new_worker_ref"}});return u(a,b,c,d,e,"new_worker_ref")}function u(a,b,c,d,e,f){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,h){c("logSharedWorkerInitStep")(a,null,null,h);(yield d("SharedWorkerMigrationUtils").isStatusLockHeld(a))&&c("FBLogger")("worker").info("Trying to create a worker %s while old one is still running",a);var i=(yield b.createSharedWorker()),j=i[0];i=i[1].worker;h==="upgrading_worker_ref"&&(yield d("SharedWorkerStorageManager").removeSharedWorkerReference(a,g));yield n(i,j,a,e,b,g);o(i,f,a);return i});return v.apply(this,arguments)}function w(a,b,c,d,e){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g){f.markEventStart("create_worker");var h=a.name;d("SharedWorkerUptimeTracker").stopUptimeTracking(h);f.addAnnotations({bool:{workerAlreadyRunning:c("supportsNativeWebLock")()?yield d("SharedWorkerMigrationUtils").isStatusLockHeld(h):null}});var i=c("supportsNativeWebLock")()?yield d("SharedWorkerMigrationUtils").isStatusLockHeld(h):!0,j=(yield d("SharedWorkerStorageManager").getSharedWorkerReference(h,f));c("logSharedWorkerInitStep")(h,j,a.resourceUrlForLogging,"create_worker_start");var k=j!=null&&d("SharedWorkerMigrationUtils").isLegacyWorkerURL(j==null?void 0:j.url);i=g&&i===!1&&k;if(j==null||i)return t(h,a,b,e,f);k=j.spin_time;i=j.version;var l=j.rev;f.addAnnotations({"int":{storageWorkerSpinTime:k,storageWorkerVersion:i,storageWorkerRev:l}});var m=d("SharedWorkerDevChangeManager").shouldUseStorageWorkerForDev(h,{storageWorkerResource:j,tabResource:a});l=l>=c("SiteData").client_revision&&(a.version===i||k>=c("SiteData")[c("StaticSiteData").spin_time_key])&&m;if(l)return p(h,j,a,b,e,f);else return r(h,j,a,b,e,f,g)});return x.apply(this,arguments)}function a(a,e,f){f=(f=f)!=null?f:{};var g=f.onQPLEvent;f=f.reason;var h=a.name,i=c("buildSharedWorkerInitQPLLogger")(g);i.start({version:1,workerName:h,callReason:f});var j=new(c("Deferred"))();d("SharedWorkerLockManager").withWorkerLock(function(d){var f;c("promiseDone")(w({name:h,version:1,resourceUrlForLogging:(f=a.url)!=null?f:"",getJSModuleBundleResource:function(){return a},createSharedWorker:function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=c("createSharedWorkerBundleUrl")();return[b,yield k(b,h,a,i)]});function e(){return d.apply(this,arguments)}return e}()},d,e,i,!1),function(a){i.markEventEnd("create_worker"),i.endSuccess(),j.resolve(a)},function(a){a=typeof a==="string"?c("err")(a):a;i.endFailure("worker_init_failure",{string:{workerInitFailureReason:a.message,errorName:a.name}});j.reject(a);d()})},{workerQPLLogger:i,onLockTimeout:function(){return j.reject(c("err")("Worker lock timeout"))}});return j.getPromise()}function y(a,e,f,g){var i;g===void 0&&(g=0);var k=a.name;i=(i=f)!=null?i:{};var m=i.onQPLEvent;i=i.reason;var n=c("buildSharedWorkerInitQPLLogger")(m);n.start({version:2,workerName:k,callReason:i,experimental_init:f==null?void 0:f.useDynamicStringInit});n.addAnnotations({bool:{usingModuleWorker:c("supportsModuleWorker")(!0)}});var o=new(c("Deferred"))(),p=g===0;d("SharedWorkerLockManager").withWorkerLock(function(g){c("promiseDone")(w({name:k,version:2,getJSModuleBundleResource:function(){return a},sandboxOnlyChecksum:a.sandboxOnlyChecksum,createSharedWorker:(f==null?void 0:f.useDynamicStringInit)===!0?b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=c("createSharedWorkerV2BundleUrlExperimental")(k);return[b,yield d("SharedWorkerV2ResourceExperimental").startV2Worker(b,k,a,n)]}):b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=c("createSharedWorkerV2BundleUrl")();return[b,yield l(b,k,a,n,p)]}),withPostMessageTimeout:p},g,e,n,(f==null?void 0:f.useDynamicStringInit)===!0),function(a){n.markEventEnd("create_worker"),n.endSuccess(),o.resolve(a)},function(a){a=typeof a==="string"?c("err")(a):a;o.reject(a);g()})},{workerQPLLogger:n,onLockTimeout:function(){return o.reject(c("err")("Worker lock timeout"))},onLockFail:function(a){o.reject(a)}});return o.getPromise()["catch"](function(d){if(d instanceof j&&g<2){n.endCancel({string:{workerInitCancelReason:d.message},"int":{workerInitRetry:g}});return new(h||(h=b("Promise")))(function(b,d){c("setTimeout")(function(){c("promiseDone")(y(a,e,f,g+1),b,d)},g===0?200:500)})}n.endFailure("worker_init_failure",{string:{workerInitFailureReason:d.message,errorName:d.name}});throw d})}function e(a,b,c){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){var g=(e=e)!=null?e:a.name,j=new(c("Deferred"))(),m=c("buildSharedWorkerTerminateQPLLogger")();m.start({workerName:g});c("promiseDone")(c("supportsNativeWebLock")()?d("SharedWorkerMigrationUtils").isStatusLockHeld(g):(h||(h=b("Promise"))).resolve(void 0),function(a){return m.addAnnotations({bool:{workerAlreadyRunning:a}})});m.addAnnotations({string:{reason:f,terminatingPageId:c("pageID")}});d("SharedWorkerLockManager").withWorkerLock(function(e){c("promiseDone")(d("SharedWorkerStorageManager").getSharedWorkerReference(g,m).then(function(e){m.markPoint("read_worker_reference",{"int":{storageWorkerVersion:e==null?void 0:e.version},bool:{storageReferenceExists:e!=null}});if(e!=null){var f=d("SharedWorkerMigrationUtils").isLegacyWorkerURL(e.url);m.addAnnotations({bool:{isLegacy:f}});var i=e.version===2?f?l(e.url,g,a,void 0,!1).then(function(a){a=a.worker;return a}):d("SharedWorkerV2ResourceExperimental").startV2Worker(e.url,g,a,void 0).then(function(a){a=a.worker;return a}):k(e.url,g,a).then(function(a){a=a.worker;return a});f=c("justknobx")._("3569")?(h||(h=b("Promise"))).resolve(null):d("SharedWorkerStorageManager").removeSharedWorkerReference(g,m);return f.then(function(){return i})}m.markPoint("storage_resource_empty");return null}),function(a){try{c("gkx")("12223")||(e(),m.addAnnotations({bool:{extendedTerminateLock:!1}}));d("SharedWorkerUptimeTracker").stopUptimeTracking(g);if(a==null){m.endSuccess();j.resolve();return}d("SharedWorkerEventManager").registerWorkerShutdownListener(a,function(a){var e=a.workerID;a=a.isInitialized;m.markPoint("worker_shut_down",{string:{workerID:e},bool:{wasInitialized:a}});e=c("justknobx")._("3569")?d("SharedWorkerStorageManager").removeSharedWorkerReference(g,m):(h||(h=b("Promise"))).resolve(null);c("promiseDone")(e,function(){return m.endSuccess()},function(a){m.endFailure("failed_to_remove_worker_reference",{string:{errorDescription:a.toString()}})});j.resolve()},{once:!0});d("SharedWorkerEventManager").emitWorkerShutdown(a,{reason:f})}catch(a){m.endFailure("terminate_worker_failure",{string:{workerTerminateFailReason:a.message}}),j.reject(a.message)}finally{c("gkx")("12223")&&(e(),m.addAnnotations({bool:{extendedTerminateLock:!0}}))}},function(a){c("FBLogger")("worker").catching(c("getErrorSafe")(a)).mustfix("Failed to terminate worker"),m.endFailure("connect_to_worker_failure",{string:{workerTerminateFailReason:a.message}}),j.reject(a.message),e()})},{workerQPLLogger:m});c("setTimeout")(function(){return j.reject()},i);return j.getPromise()});return z.apply(this,arguments)}function f(a){return A.apply(this,arguments)}function A(){A=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("SharedWorkerStorageManager").getSharedWorkerReference(a.name));return a!=null});return A.apply(this,arguments)}g.SelfTerminationError=j;g.createPushSafeSharedWebWorkerAsync=a;g.createPushSafeSharedWebWorkerV2Async=y;g.terminateSharedWorker=e;g.doesSharedWorkerReferenceExist=f}),98);
__d("SharedWorkerV2ResourceExperimental",["Deferred","Promise","SharedWorkerBundleResource","SharedWorkerDevChangeManager","SharedWorkerEventManager","SharedWorkerLoggingUtils","SharedWorkerMigrationUtils","SharedWorkerUptimeTracker","SiteData","StaticSiteData","TrustedTypesWebWorkerScriptURLPolicy","asyncToGeneratorRuntime","buildSharedWorkerInitQPLLogger","buildSharedWorkerTerminateQPLLogger","createSharedWorkerV2BundleUrlExperimental","justknobx","pageID","promiseDone","setTimeout","supportsModuleWorker","supportsNativeWebLock"],(function(a,b,c,d,e,f,g){"use strict";var h,i=50,j=5e3,k=2e3;function l(a,b,e,f){return d("SharedWorkerDevChangeManager").shouldUpgradeWorkerForDevExperimental(a)&&!f?!0:b<c("SiteData").client_revision&&e<c("SiteData")[c("StaticSiteData").spin_time_key]}function a(a,b,c){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){var g=a.name,j=c("buildSharedWorkerInitQPLLogger")(f==null?void 0:f.onQPLEvent);j.start({version:2,workerName:g,experimental_init:!0,callReason:f==null?void 0:f.reason,migrationEnabled:!0});j.markEventStart("create_worker");c("supportsNativeWebLock")()&&c("promiseDone")(d("SharedWorkerMigrationUtils").isStatusLockHeld(g).then(function(a){j.addAnnotations({bool:{workerAlreadyRunning:a}})}));(f==null?void 0:f.migratedWorker)===!0&&(yield d("SharedWorkerMigrationUtils").checkStorageAndTerminateLegacyWorker({name:g,logger:j}));f=(yield n(a,j));var k=f.worker,l=f.needsUpgrade;return new(h||(h=b("Promise")))(function(b,f){var h=function(a){return b(p(a,g,j,e))};l?(d("SharedWorkerEventManager").registerWorkerShutdownListener(k,function(b){var d=b.workerID;b=b.isInitialized;j.markEventEnd("old_worker_shutdown",{string:{oldWorkerID:d},bool:{oldWorkerWasInitialized:b}});c("setTimeout")(function(){return n(a,j).then(function(a){a=a.worker;return h(a)})},i)},{once:!0}),j.markEventStart("old_worker_shutdown"),d("SharedWorkerEventManager").emitWorkerShutdown(k,{upgrade:!0})):h(k)})});return m.apply(this,arguments)}function n(a,b){var e=a.name,f=c("createSharedWorkerV2BundleUrlExperimental")(e);f=c("TrustedTypesWebWorkerScriptURLPolicy").createScriptURL(f);var g=c("supportsModuleWorker")(!0)?"module":"classic",h=new SharedWorker(f,{name:e,type:g}),i=new Set();d("SharedWorkerEventManager").registerWorkerInitPointsListener(h,function(a){if(i.has(a))return;i.add(a);b==null?void 0:b.markPoint("worker_init_point_"+a)});var j=new(c("Deferred"))();d("SharedWorkerEventManager").registerGetWorkerRevListener(h,b,function(c){var d=c.rev,f=c.spinTime;c=c.workerChecksum;c=l(e,d,f,a.sandboxOnlyChecksum===c);j.resolve(c);c?b.addAnnotations({"int":{oldWorkerRev:d,oldWorkerSpinTime:f}}):b.addAnnotations({"int":{workerRev:d,workerSpinTime:f}})});o(h,e,b);h.port.start();d("SharedWorkerEventManager").emitConnectionAckRequest(h,b);return j.getPromise().then(function(a){return{worker:h,needsUpgrade:a}})}function o(a,b,c,e){a.addEventListener("error",function(a){d("SharedWorkerLoggingUtils").logSharedWorkerError(c,a,b)});d("SharedWorkerEventManager").registerForwardListeners(a);d("SharedWorkerEventManager").registerWorkerSelfTerminationListener(a,function(a,b,d,e){c.endFailure("worker_init_failure",{string:{selfTerminationError:e,selfTerminationReason:b}})},{once:!0});d("SharedWorkerEventManager").registerConnectionAckListener(a,function(a,b){c==null?void 0:c.addAnnotations({string:{connectedFrom:a,workerID:b}}),c==null?void 0:c.markPoint("worker_connection_established")},{once:!0});return a}function p(a,b,e,f){d("SharedWorkerEventManager").registerWorkerShutdownListener(a,function(a){var e=a.reason,g=a.workerID;d("SharedWorkerLoggingUtils").logShutdown(b,null,e,g);e==="requested-upgrade"?c("setTimeout")(function(){return f==null?void 0:f(e,g)},1e3):e==="dynamic_string_worker_rollback"?f==null?void 0:f("maw_request_refresh",g):f==null?void 0:f(e,g);d("SharedWorkerUptimeTracker").stopUptimeTracking(b)});e.markEventEnd("create_worker");e.endSuccess();d("SharedWorkerUptimeTracker").startUptimeTracking(a,b);d("SharedWorkerDevChangeManager").trackCreatedWorker(b);return a}function q(a,e,f,g,i){i===void 0&&(i=0);var j=f.name,l=c("TrustedTypesWebWorkerScriptURLPolicy").createScriptURL(a),m=c("supportsModuleWorker")(!0)?"module":"classic",n=new SharedWorker(l,{name:j,type:m});g==null?void 0:g.markPoint("shared_worker_construct_done");g==null?void 0:g.addAnnotations({string:{workerUrl:l.toString()}});var o=new(c("Deferred"))(),p=[];p.push(d("SharedWorkerEventManager").registerConnectionAckListener(n,function(a,b){g==null?void 0:g.addAnnotations({string:{connectedFrom:a,workerID:b}}),g==null?void 0:g.markPoint("worker_connection_established"),o.resolve()},{once:!0}));p.push(d("SharedWorkerEventManager").registerWorkerInitPointsListener(n,function(a){g==null?void 0:g.markPoint("worker_init_point_"+a)}));p.push(d("SharedWorkerEventManager").registerForwardListeners(n));d("SharedWorkerEventManager").emitConnectionAckRequest(n,g);n.addEventListener("error",function(a){d("SharedWorkerLoggingUtils").logSharedWorkerError(g,a,e)});var r=new(c("Deferred"))();p.push(d("SharedWorkerEventManager").registerGetWorkerRevListener(n,g,function(a){var b=a.rev;a=a.spinTime;g==null?void 0:g.addAnnotations({"int":{initialWorkerRev:b,initialSpinTime:a}});r.resolve({worker:n,rev:b,spinTime:a})}));p.push(d("SharedWorkerEventManager").registerWorkerSelfTerminationListener(n,function(a,b,c,f){g==null?void 0:g.addAnnotations({string:{selfTerminationError:f}}),d("SharedWorkerLoggingUtils").logSelfTermination(e,a,b,c),r.reject(new(d("SharedWorkerBundleResource").SelfTerminationError)(b))},{once:!0}));p.push(d("SharedWorkerEventManager").registerWorkerShutdownListener(n,function(a){var b=a.reason;a=a.workerID;g==null?void 0:g.addAnnotations({string:{shutdownReason:b}});d("SharedWorkerLoggingUtils").logShutdown(e,null,b,a);r.reject(new(d("SharedWorkerBundleResource").SelfTerminationError)((a=b)!=null?a:"unknownShutdown"))},{once:!0}));n.port.start();i===0&&c("justknobx")._("1707")&&void (h||(h=b("Promise"))).race([o.getPromise().then(function(){return"success"}),new h(function(a){c("setTimeout")(function(){a("timeout")},k)})]).then(function(b){if(b==="timeout"){b=n;var c=q(a,e,f,g,i+1);void c.then(function(a){return r.resolve(a)});p.forEach(function(a){return a()});b.port.close()}});return r.getPromise()}function e(a,b){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=a.name,f=new(c("Deferred"))();a=(yield d("SharedWorkerMigrationUtils").isStatusLockHeld(e));var g=c("buildSharedWorkerTerminateQPLLogger")();if(!a){g.start({workerName:e});g.markPoint("no_worker_running");g.endSuccess();return}g.start({workerName:e});g.addAnnotations({string:{reason:b,terminatingPageId:c("pageID")}});a=c("createSharedWorkerV2BundleUrlExperimental")(e);a=c("TrustedTypesWebWorkerScriptURLPolicy").createScriptURL(a);var h=c("supportsModuleWorker")(!0)?"module":"classic";a=new SharedWorker(a,{workerName:e,type:h});g.markPoint("worker_created");d("SharedWorkerEventManager").registerWorkerShutdownListener(a,function(a){a=a.workerID;g.markPoint("worker_shut_down",{string:{workerID:a}});g.endSuccess();d("SharedWorkerUptimeTracker").stopUptimeTracking(e);f.resolve()},{once:!0});a.port.start();d("SharedWorkerEventManager").emitWorkerShutdown(a,{reason:b});c("setTimeout")(function(){return f.reject()},j);return f.getPromise()});return r.apply(this,arguments)}g.DELAY_FOR_WORKER_SHUTDOWN_MS=i;g.createPushSafeSharedWebWorkerV2Async=a;g.startV2Worker=q;g.terminateSharedWorker=e}),98);
__d("WebWorkerV2Resource",["TrustedTypesWebWorkerScriptURLPolicy","WebWorkerV2DynamicData","XCometFBMultiSiteWebWorkerV2InitScriptControllerRouteBuilder","forEachObject","getAsyncParamsFromCurrentPageURI","getWorkerInitScriptSPINParams","nullthrows","promiseDone","supportsModuleWorker"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e){b=(b=b)!=null?b:a.name;var f=c("supportsModuleWorker")(!1)&&e!==!0?"module":"classic",g=c("getWorkerInitScriptSPINParams")();c("forEachObject")(c("getAsyncParamsFromCurrentPageURI")(),function(a,b){g.set(b,a)});e=c("nullthrows")(c("XCometFBMultiSiteWebWorkerV2InitScriptControllerRouteBuilder").buildUri({worker_type:c("supportsModuleWorker")(!1)&&e!==!0?"MODULE":"CLASSIC"}).addQueryParams(g)).toString();e=c("TrustedTypesWebWorkerScriptURLPolicy").createScriptURL(e);var h=new Worker(e,{name:b,type:f});c("promiseDone")(d("WebWorkerV2DynamicData").readDynamicDataForWorker(a).then(function(a){h.postMessage({type:"ww-hrp-init",hrp:a.hrp,js_env:a.js_env,is_dev:!1,tiered:!0})}));return{worker:h,url:e.toString()}}g.createDedicatedV2WebWorker=a}),98);
__d("MAWWebWorkerSingleton",["Deferred","MAWInit","MAWMIC","MAWStartupLoggingUtils","Promise","SharedWorkerBundleResource","SharedWorkerMigrationUtils","SharedWorkerV2ResourceExperimental","WAResolvable","WebWorkerV2Resource","cr:6600","gkx","justknobx","promiseDone","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i=null,j=function(a){i=a},k=function(){return i},l=e,m=new(d("WAResolvable").Resolvable)(),n=null;function a(){return d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()?d("SharedWorkerMigrationUtils").isStatusLockHeld(b("cr:6600").name):(h||(h=b("Promise"))).resolve(n!==null)}function e(){n=null}function f(a){if(n){d("MAWMIC").addPoint(a+"_wait_on_worker_creation");d("MAWInit").MAWInit.logPoint(a+"_wait_on_worker_creation");return n}d("MAWInit").MAWInit.logPoint(a+"_create_worker_start");d("MAWMIC").addPoint(a+"_create_worker_start");n=(d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()?o(a):p().then(function(a){return{worker:a,workerID:"dedicated"}})).then(function(b){var c=b.worker;b=b.workerID;d("MAWMIC").addPoint(a+"_create_worker_end");d("MAWInit").MAWInit.logPoint(a+"_create_worker_end");return{worker:c,workerID:b}},function(a){n=null;throw a});return n}function o(a){var e=function(a,b,d){c("promiseDone")(m.promise.then(function(){return l(a,b,d)}))},f=new(c("Deferred"))(),g=c("gkx")("7313");d("MAWMIC").addBoolAnnotation("migrationEnabled",g);g=g?d("SharedWorkerV2ResourceExperimental").createPushSafeSharedWebWorkerV2Async(b("cr:6600"),e,{migratedWorker:!0,onQPLEvent:d("MAWStartupLoggingUtils").logSharedWorkerQPLEvents,reason:a}):d("SharedWorkerBundleResource").createPushSafeSharedWebWorkerV2Async(b("cr:6600"),e,{onQPLEvent:d("MAWStartupLoggingUtils").logSharedWorkerQPLEvents,reason:a,useDynamicStringInit:c("gkx")("8737")});return g.then(function(a){j(a);if(c("justknobx")._("3112")){var b=function(a){var b;if(typeof a.data==="object"&&((b=a.data)==null?void 0:b.type)==="connection-ack"&&typeof ((b=a.data)==null?void 0:b.response)==="object"&&typeof ((b=a.data)==null?void 0:(b=b.response)==null?void 0:b.from)==="string"){b=typeof ((b=a.data)==null?void 0:(b=b.response)==null?void 0:b.workerID)==="string"?(b=a.data)==null?void 0:(a=b.response)==null?void 0:a.workerID:void 0;b!=null?(d("MAWMIC").addStringAnnotation("workerID",b),f.resolve(b)):d("MAWMIC").addStringAnnotation("workerID","unknown")}};a.port.addEventListener("message",b);a.port.postMessage({type:"ww-connection-ack"})}else f.resolve("unknown");a.addEventListener("error",function(a){d("MAWStartupLoggingUtils").logWorkerError("Shared Worker",a,"")});return f.getPromise().then(function(b){return{worker:a.port,workerID:b}})})}function p(){return(h||(h=b("Promise"))).resolve(d("WebWorkerV2Resource").createDedicatedV2WebWorker(b("cr:6600"))).then(function(a){var b=a.url;a=a.worker;a.onerror=function(a){return d("MAWStartupLoggingUtils").logWorkerError("Dedicated Worker",a,b)};d("MAWStartupLoggingUtils").setImportScriptsErrorListener(a);return a})}function q(a){l=a,m.resolve()}g.getSharedWorkerInstance__TEST_ONLY=k;g.doesWorkerExist=a;g.resetWorkerCreation=e;g.createWorkerIfNone=f;g.setOnCloseForWorkerInstance=q}),98);
__d("MAWWaitForBackendSetup",["ErrorSerializer","MAWInit","MAWInitError","MAWMIC","MAWWebWorkerSingleton","Promise","err","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=new(h||(h=b("Promise")))(function(a,b){i=a,j=b}),l=!1,m=!1,n=!1,o=!1,p=null,q=i,r=j;function s(a){return new(h||(h=b("Promise")))(function(b,e){k.then(b)["catch"](function(b){var f=a+" rejected because backend setup failed: "+b.message+".";b=b instanceof d("MAWInitError").MAWInitError?b.error:null;b!=null&&(f=f.concat(" More error detail: "+c("ErrorSerializer").toReadableMessage(b)));e(c("err")(f))})})}function a(a,b){c("promiseDone")(s(b).then(function(){a()}))}function t(){if(!o)return;k=new(h||(h=b("Promise")))(function(a,b){i=a,j=b});o=!1;l=!1;q=i;r=j;m=!0;n=!1}function e(a){l=!0,o=!0,n=!1,q==null?void 0:q(a)}function f(a){l=!1,o=!0,n=!1,r==null?void 0:r(a)}function u(){return l}function v(){return o}function w(){return m}function x(a){p=a}function y(a){if(p==null||p!==a)return;p=null;d("MAWWebWorkerSingleton").resetWorkerCreation();t();d("MAWInit").MAWInit.logPoint("reset_current_worker");d("MAWMIC").addPoint("reset_current_worker")}function z(){return p}function A(){n=!0}function B(){return n}g.waitForBackendSetup=s;g.runAfterBackendSetup=a;g.resetBackendSetup=t;g.resolveBackendSetup=e;g.rejectBackendSetup=f;g.isBackendSetupSuccessful=u;g.isBackendSetupSettled=v;g.wasBackendSetupReset=w;g.setCurrentWorker=x;g.resetCurrentWorker=y;g.getCurrentWorkerID=z;g.markBackendSetupStarted=A;g.isBackendSetupInProgress=B}),98);
__d("MAWTimedBridge",["FBLogger","MAWBridgeLoggingUtils","MAWMaybeWithTimeout","MAWWaitForBackendSetup","MAWWebWorkerSingleton"],(function(a,b,c,d,e,f,g){"use strict";var h=17e4;function a(a,b,e,f,g){g===void 0&&(g=h);return d("MAWWaitForBackendSetup").waitForBackendSetup(e).then(function(){return d("MAWMaybeWithTimeout").maybeWithTimeout(a(),g,function(){return d("MAWWebWorkerSingleton").doesWorkerExist().then(function(a){d("MAWBridgeLoggingUtils").routeTimeoutFail(b,e,f,a);var g=new i("Bridge route "+e+" timed out");throw c("FBLogger")("messenger_e2ee_web").catching(g).mustfixThrow("Failed to complete bridge route %s in time. WorkerExists: %s",e,a)})},e)})}var i=function(b){babelHelpers.inheritsLoose(a,b);function a(a){var c;c=b.call(this,a)||this;c.name="BridgeTimeoutError";c.message=a;return c}return a}(babelHelpers.wrapNativeSuper(Error));g.DEFAULT_TIMEOUT_MS=h;g.bridgeTimeout=a;g.MAWBridgeTimeoutError=i}),98);
__d("MAWBridgeFireAndForget",["MAWBridge","MAWBridgeLoggingUtils","MAWTimedBridge","MAWWaitForBackendSetup","MAWWorkerEvent","Promise","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("justknobx")._("1143");function a(a,c,e,f){return d("MAWWaitForBackendSetup").runAfterBackendSetup(function(){var g=d("MAWBridgeLoggingUtils").getBridgeEventInstanceKey(c);f!==!0&&d("MAWBridgeLoggingUtils").routeStart("fireAndForget",a,c,g);void d("MAWTimedBridge").bridgeTimeout(function(){return new(h||(h=b("Promise")))(function(b){d("MAWBridge").getBridge().fireAndForget(a,c,e,f,{onAck:function(e){f!==!0&&(d("MAWWorkerEvent").logAck(g,c,e),d("MAWBridgeLoggingUtils").routeSuccess(a,c,g)),b()},onSend:function(a){var b=a.queueMsgs;a=a.queueSize;f!==!0&&(d("MAWWorkerEvent").logSend(g,c,"fireAndForget"),d("MAWWorkerEvent").logAnnotations(g,{"int":{bridgeSize:a},string_array:{bridgeMsgs:b}}))}},{bridgeQPLInstanceKey:g})})},a,c,g,i)},c)}g.fireAndForget=a}),98);
__d("MAWClientConsistencyRefresh",["ClientConsistencyEventEmitter","CurrentUser"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(c("CurrentUser").getAppID()){case 772021112871879:c("ClientConsistencyEventEmitter").emit("hardRefresh",a);break;default:c("ClientConsistencyEventEmitter").emit("softRefresh",a)}}g["default"]=a}),98);
__d("MAWCrossWorkerPortal",["FBLogger","WACrossWorkerPortal","pageID"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,e,f){if(h!=null)return h;h=d("WACrossWorkerPortal").attachPortal(a,b,e,c("pageID"),f);return h}function b(){if(h==null){c("FBLogger")("messenger_e2ee_web").warn("Trying to kill portal before its setup");return}d("WACrossWorkerPortal").killPortalAndSendPendingToBridge(h)}g.getOrCreateCrossWorkerPortal=a;g.killPortalWhenWorkerTerminating=b}),98);
__d("MAWWorkerOnClose",["MAWSetupWorkerAuxStateForLogging","MAWWaitForBackendSetup","QPLUserFlow","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=c("qpl")._(1056841865,"2862");function a(a,b,e){c("QPLUserFlow").start(h,{annotations:{string:{currentWorkerId:d("MAWWaitForBackendSetup").getCurrentWorkerID(),terminationMsgType:b,terminationReason:a,workerID:e},string_array:{pastWorkerTerminationMsgTypes:d("MAWSetupWorkerAuxStateForLogging").restartMessageTypes,pastWorkerTerminationReasons:d("MAWSetupWorkerAuxStateForLogging").restartReasons}}})}function b(a){c("QPLUserFlow").endSuccess(h,{annotations:{string:{outcome:a}}})}function e(a,b){c("QPLUserFlow").endFailure(h,a,{error:b})}g.ON_WORKER_CLOSED_HANDLER_QPL=h;g.startQPL=a;g.success=b;g.fail=e}),98);
__d("MAWSetupWorker",["CurrentUser","Deferred","FBLogger","IGDWebUtils","MAWBridgeObserver","MAWClientConsistencyRefresh","MAWCommonSetupWorker","MAWCrossWorkerPortal","MAWInit","MAWLoggerUtils","MAWMIC","MAWSetupWorkerAuxStateForLogging","MAWUnrecoverableDbErrors","MAWWaitForBackendSetup","MAWWebWorkerSingleton","MAWWorkerOnClose","QPLUserFlow","SharedWorkerBundleResource","SharedWorkerV2ResourceExperimental","WATagsLogger","asyncToGeneratorRuntime","cr:6600","err","gkx","promiseDone","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Shared worker responded to termination request: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["worker terminating: for ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["worker doesn't exist, no need to terminate"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["worker setting up"]);k=function(){return a};return a}var l=function(){return c("gkx")("8512")},m=d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.WorkerSetup,d("MAWLoggerUtils").Tag.MAWInit]),n=d("IGDWebUtils").isInstagramWebSupportedApp(Number(c("CurrentUser").getAppID())),o=n?"IGDAWMainWorker":"MAWMainWorker",p=null,q=!1;function a(a){q=a}function r(a){switch(a){case"mawInit":return!0;case"mawReinitSetupMutex":case"mawReinitReregDevice":case"bridgeRecovery":case"workerUpgraded":case"rebootRequired":case"workerTerminated":default:return!1}}function s(a,b,c,d,e){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,h){if(q)throw c("err")("Worker is permanently killed.");d("MAWWaitForBackendSetup").markBackendSetupStarted();var i=function(b){return s(a,e,f,g,b)};(h==="bridgeRecovery"||h==="backendSetupFailure")&&c("QPLUserFlow").addPoint(d("MAWBridgeObserver").BAD_STATE_RECOVERY_QPL,"create_worker_start");d("MAWWebWorkerSingleton").setOnCloseForWorkerInstance(function(a,b,e){var f;d("MAWWorkerOnClose").startQPL(a,e,b);var g=(f=a)!=null?f:"unknown",j=D(g)&&d("MAWWaitForBackendSetup").isBackendSetupSettled();d("MAWSetupWorkerAuxStateForLogging").restartReasons.push(g);d("MAWSetupWorkerAuxStateForLogging").restartMessageTypes.push((f=e)!=null?f:"unknown");if(d("MAWWaitForBackendSetup").getCurrentWorkerID()==null||b!==d("MAWWaitForBackendSetup").getCurrentWorkerID()){d("MAWInit").MAWInit.logPoint(g+"_worker_termination_skipped");d("MAWMIC").addPoint(g+"_worker_termination_skipped");d("MAWWorkerOnClose").success(g+"_worker_restart_skipped");c("FBLogger")("maw_worker").warn("Worker termination skipped %s. Terminate reason: %s, Worker: %s, current worker: %s",h,a,b,d("MAWWaitForBackendSetup").getCurrentWorkerID());return}d("MAWWaitForBackendSetup").resetCurrentWorker(b);c("FBLogger")("maw_worker").warn("Worker termination started %s. Terminate reason: %s, Worker: %s",h,a,b);d("MAWInit").MAWInit.logPoint(g+"_worker_terminated");d("MAWMIC").addPoint(g+"_worker_terminated");d("MAWInit").MAWInit.addStringArrayAnnotation("workerTerminationReason",d("MAWSetupWorkerAuxStateForLogging").restartReasons);d("MAWMIC").addStringArrayAnnotation("workerTerminationReason",d("MAWSetupWorkerAuxStateForLogging").restartReasons);d("MAWInit").MAWInit.addStringArrayAnnotation("workerTerminationMsgType",d("MAWSetupWorkerAuxStateForLogging").restartMessageTypes);d("MAWMIC").addStringArrayAnnotation("workerTerminationMsgType",d("MAWSetupWorkerAuxStateForLogging").restartMessageTypes);a==="requested-upgrade"?c("promiseDone")(B(),function(){return i("workerUpgraded").then(function(){return d("MAWWorkerOnClose").success("workerUpgraded")})["catch"](function(a){d("MAWWorkerOnClose").fail("workerUpgradeFailed",a);throw a})}):l()&&c("promiseDone")(B(),function(){if(j){q=!0;c("FBLogger")("maw_worker").warn("Tab displays soft refresh. Flow: %s",g);d("MAWInit").MAWInit.logPoint(g+"_soft_refresh");d("MAWMIC").addPoint(g+"_soft_refresh");c("MAWClientConsistencyRefresh")("maw_request_refresh");d("MAWWorkerOnClose").success("softRefresh");return}if(g!=="logout")return i(g+"_worker_terminated").then(function(){return d("MAWWorkerOnClose").success(g+"_worker_terminated")})["catch"](function(a){d("MAWInit").MAWInit.fail("worker_restart_failed",a),d("MAWWorkerOnClose").fail("workerUpgradeFailed",a),d("MAWWaitForBackendSetup").rejectBackendSetup(a)})})});var j=(yield d("MAWWebWorkerSingleton").createWorkerIfNone(h)),n=j.worker;j=j.workerID;d("MAWWaitForBackendSetup").setCurrentWorker(j);j=new(c("Deferred"))();p=j.getPromise();(h==="bridgeRecovery"||h==="backendSetupFailure")&&c("QPLUserFlow").addPoint(d("MAWBridgeObserver").BAD_STATE_RECOVERY_QPL,"create_worker_end");m.LOG(k());d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()&&n.addEventListener("message",function(a){var b;typeof a.data==="object"&&((b=a.data)==null?void 0:b.type)==="sw-shutdown"&&typeof a.data.response==="object"&&((b=a.data.response)==null?void 0:b.reason)==="maw-request-refresh"&&c("MAWClientConsistencyRefresh")("maw_request_refresh")});var r=new(d("MAWCommonSetupWorker").BridgeAdapter)(n,o);yield e(r);j.resolve(r);d("MAWMIC").addPoint(h+"_connect_to_backend");yield d("MAWInit").MAWInit.measurePerformance(h+"-init_backend",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=function(){return d("MAWCommonSetupWorker").initWorker(r,a,i,f,h)};b=d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()?yield b():yield r.fullyConnected.then(b);d("MAWWaitForBackendSetup").resolveBackendSetup(b)}));return d("MAWWaitForBackendSetup").waitForBackendSetup("setup-worker")});return t.apply(this,arguments)}function e(a,b,e,f,g){var h=s(a,b,e,f,g);r(g)&&c("promiseDone")(d("MAWWaitForBackendSetup").waitForBackendSetup("init bridge recovery observer").then(function(){d("MAWBridgeObserver").initUnackedMessagesObserver({onConnectToExistingWorker:e,onTerminateWorker:f,onWorkerConnect:b,vaultMaterials:a})}));return h}function f(){return p}function u(a){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){c("FBLogger")("maw_worker").info("Terminating dedicated worker: %s. Bridge Promise: %s",a,!!p);if(!p){m.LOG(j());return!1}m.LOG(i(),a);yield B();return!0});return v.apply(this,arguments)}function w(){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield u("terminateWorkerPermanently"),q=!0});return x.apply(this,arguments)}function y(a,e){var f=c("gkx")("7313");return f?d("SharedWorkerV2ResourceExperimental").terminateSharedWorker(b("cr:6600"),a?"maw-request-refresh":(f=e)!=null?f:"unknown"):d("SharedWorkerBundleResource").terminateSharedWorker(b("cr:6600"),null,a?"maw-request-refresh":(f=e)!=null?f:"unknown")}function z(a){return A.apply(this,arguments)}function A(){A=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker();if(b){c("FBLogger")("maw_worker").info("Terminating shared worker: %s",a);b=(yield y(!1,a).then(function(){return!0},function(){return!1}));m.LOG(h(),b);l()||(yield B())}else yield u(a)});return A.apply(this,arguments)}function B(){return C.apply(this,arguments)}function C(){C=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;c("FBLogger")("maw_worker").info("Updating worker state on termination");(a=(yield p))==null?void 0:a.close();p=null;c("gkx")("2215")&&d("MAWWaitForBackendSetup").resetBackendSetup();d("MAWCrossWorkerPortal").killPortalWhenWorkerTerminating();d("MAWWebWorkerSingleton").resetWorkerCreation()});return C.apply(this,arguments)}function D(a){if(a==="MAWEARKeychainDecryptionError"||d("MAWUnrecoverableDbErrors").isUnrecoverableDbErrorByName(a))return!0;return a==="update-required-fbid_change"||a==="update-required-vault_materials_change"?!0:!1}g.setPreventWorkerRestart=a;g.getOrSetupWorker=e;g.waitForWorkerSetup=f;g.terminateDedicatedWorker=u;g.terminateWorkerPermanently=w;g.killSharedWorker=y;g.terminateWorker=z}),98);
__d("MAWWorkerReboot",["FBLogger","MAWBridgeObserver","MAWSetupWorker","MAWWaitForBackendSetup","ODS","Promise","QPLUserFlow","pageID","promiseDone","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a){(i||(i=d("ODS"))).bumpEntityKey(3185,"armadillo_shared_worker_reboot","shared_worker_reboot_"+a)}var k=d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker(),l=function(a){switch(a){case"bridge_recovery":return"bridgeRecovery";case"backend_setup_failure":return"backendSetupFailure"}};function a(a,e,f,g,i){c("QPLUserFlow").start(d("MAWBridgeObserver").BAD_STATE_RECOVERY_QPL,{annotations:{bool:{isSharedWorker:k},string:{trigger:i,workerInitPageID:c("pageID")}}});c("FBLogger")("maw_worker").info("Rebooting worker started.");j("start");d("MAWWaitForBackendSetup").resetBackendSetup();var m=l(i);c("QPLUserFlow").addPoint(d("MAWBridgeObserver").BAD_STATE_RECOVERY_QPL,"terminate_worker_start");return new(h||(h=b("Promise")))(function(b,h){return d("MAWSetupWorker").terminateWorker(m).then(function(){c("QPLUserFlow").addPoint(d("MAWBridgeObserver").BAD_STATE_RECOVERY_QPL,"terminate_worker_end");c("FBLogger")("maw_worker").info("Reboot process killed existing worker successfully.");return d("MAWSetupWorker").getOrSetupWorker(a,e,f,g,m).then(function(a){c("FBLogger")("maw_worker").info("Rebooting worker success. Reason for reboot: %s",m),j("success"),c("QPLUserFlow").endSuccess(d("MAWBridgeObserver").BAD_STATE_RECOVERY_QPL),c("promiseDone")(e(a)),b()})})["catch"](function(a){c("FBLogger")("maw_worker").info("Rebooting worker failed. Error message: %s",a.message),j("fail"),c("QPLUserFlow").endFailure(d("MAWBridgeObserver").BAD_STATE_RECOVERY_QPL,a.message),d("MAWWaitForBackendSetup").rejectBackendSetup(a),h(a)})})}g.rebootWorker=a}),98);
__d("MAWBridgeObserver",["FBLogger","MAWWaitForBackendSetup","MAWWorkerReboot","promiseDone","qex","qpl"],(function(a,b,c,d,e,f,g){"use strict";a=c("qpl")._(1056840252,"808");var h=5,i=[],j=!1,k,l=function(){i=[]};b=function(a){if(!o())return;if(d("MAWWaitForBackendSetup").isBackendSetupInProgress()){l();return}if(n().length>=h&&!d("MAWWaitForBackendSetup").isBackendSetupInProgress()){c("FBLogger")("maw_worker").info("Minimum threshold of unacked messages reached: %s. Unacked messages: %s",h,JSON.stringify(n()));var b=c("qex")._("440"),e=c("qex")._("468")||h;b===!0&&n().length>=e?(c("FBLogger")("maw_worker").info("QE threshold of unacked messages reached: %s. Unacked messages: %s",h,JSON.stringify(n())),l(),c("promiseDone")(m())):(c("FBLogger")("maw_worker").info("Bridge recovery attempt skipped. Reason for skipped: maw_bridge_recovery_v2_enabled: %s, maw_bridge_recovery_threshold: %s",b,e),i.push(a))}else i.push(a)};var m=function(){c("FBLogger")("maw_worker").info("Starting bridge recovery attempt.");return d("MAWWorkerReboot").rebootWorker(k.vaultMaterials,k.onWorkerConnect,k.onConnectToExistingWorker,k.onTerminateWorker,"bridge_recovery").then(function(){c("FBLogger")("maw_worker").info("Bridge recovery attempt successful. Worker has restarted.")},function(a){c("FBLogger")("maw_worker").info("Bridge recovery attempt failed. Worker has failed to restart. Error: %s",a.message);throw a})};e=function(a){j=!0,k=a};var n=function(){return i},o=function(){return j};f=function(){return k};g.BAD_STATE_RECOVERY_QPL=a;g.MIN_UNACKED_EVENTS_THRESHOLD=h;g.resetUnackedMessages=l;g.notifyUnackedEvent=b;g.attemptRecovery=m;g.initUnackedMessagesObserver=e;g.getUnackedMessages=n;g.getIsObserverActive=o;g.getProps=f}),98);
__d("MAWGetDBVersionForTest",["justknobx"],(function(a,b,c,d,e,f,g){"use strict";function a(){if(!c("justknobx")._("1495"))return;var a=new URL(document.location.href);a=a.searchParams.get("db_version");if(a==null)return;if(a==="current"||a==="latest")return a;a=parseInt(a,10);if(Number.isInteger(a))return Number(a)}g.getDbVersionForTest=a}),98);
__d("WADevToolMessageChannel",[],(function(a,b,c,d,e,f){"use strict";var g=new MessageChannel(),h;a=function(){g=new MessageChannel();h(g);return g};b=function(){return g};c=function(a){h=a,h(g)};f.createNewChannel=a;f.getMostRecentChannel=b;f.onCreateNewChannel=c}),66);
__d("MAWCommonSetupWorker",["Deferred","MAWCurrentUser","MAWGetDBVersionForTest","MAWInit","MAWMIC","MAWSetupWorker","MAWWaitForBackendSetup","MAWWebWorkerSingleton","MessengerWebInitData","Promise","WADevToolMessageChannel","WALogger","WorkerClient","WorkerMessagePort","err","gkx","pageID","promiseDone","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Terminating worker and rebooting..."]);i=function(){return a};return a}var j=c("gkx")("3282");e=function(a){babelHelpers.inheritsLoose(b,a);function b(b,c){var e;e=a.call(this,b,c)||this;e.onmessage=null;e.$BridgeAdapter$p_1=b;d("WorkerClient").init(babelHelpers.assertThisInitialized(e));e.onUnhandledMessage.add(function(a){e.onmessage&&e.onmessage({data:a})});e.addMessageListener("worker-setup",function(a){a.status==="worker-ready"&&d("MAWInit").MAWInit.addBoolAnnotation("workerReadyReceived",!0)});return e}var c=b.prototype;c.getBridgePort=function(){return this};return b}(d("WorkerMessagePort").WorkerSyncedMessagePort);function a(a,e,f,g,j){var l=d("MAWWaitForBackendSetup").getCurrentWorkerID(),m=new(c("Deferred"))();a.addMessageListener("worker-setup",function(e){if(e.setupHash!==c("pageID"))return;if(e.status==="success")m.resolve(a.getBridgePort());else if(e.status==="failure"){var k;m.reject(c("err")((k=e.msg)!=null?k:"Error setting up worker"))}else if(e.status==="already-setup")if(e.action==="no-action"){m.resolve(a.getBridgePort());g();d("MAWInit").MAWInit.logPoint(j+"_backend_already_setup");d("MAWMIC").addPoint(j+"_backend_already_setup");return}else if(e.action==="reboot-required"){d("WALogger").DEV(i());d("MAWMIC").addPoint(j+"_worker_rebooting");d("MAWInit").MAWInit.logPoint(j+"_worker_rebooting");d("MAWInit").MAWInit.addStringAnnotation("workerRebootReason",(k=e==null?void 0:e.reason)!=null?k:"none");d("MAWMIC").addStringAnnotation("workerRebootReason",(k=e==null?void 0:e.reason)!=null?k:"none");k=d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()?(h||(h=b("Promise"))).resolve(d("MAWWaitForBackendSetup").resetCurrentWorker(l)):d("MAWSetupWorker").terminateDedicatedWorker("reboot required");return k.then(function(){return f("rebootRequired").then(function(a){return m.resolve(a)})["catch"](function(a){return m.reject(a)})})}else throw c("err")("Invalid action for worker-setup:already-setup: "+e.action);else{d("MAWInit").MAWInit.addBoolAnnotation("invalidSetupMessageReceived",!0);throw c("err")("Invalid message for worker")}});a.addMessageListener("worker-setup-ack",function(a){if(a.setupHash!==c("pageID"))return;d("MAWInit").MAWInit.logPoint(j+"_backend_setup_ack");d("MAWMIC").addPoint(j+"_backend_setup_ack");a=(a=a.backendState)!=null?a:"none";d("MAWInit").MAWInit.addStringAnnotation("backendAckState",a);d("MAWMIC").addStringAnnotation("backendAckState",a)});k(a,e);c("promiseDone")(d("MAWWebWorkerSingleton").doesWorkerExist(),function(a){return d("MAWInit").MAWInit.addBoolAnnotation("workerExistsOnSetup",a)});return m.getPromise()}function k(a,b){b={content:{createdAt:c("MessengerWebInitData").createdAt,fbId:d("MAWCurrentUser").getID(),sessionId:c("MessengerWebInitData").sessionId,testDbVersion:d("MAWGetDBVersionForTest").getDbVersionForTest(),userKeyBase:c("MessengerWebInitData").userKeyBase,vaultMaterials:b},setupHash:c("pageID"),type:"worker-setup"};if(j){d("MAWInit").MAWInit.addBoolAnnotation("devToolsEnabled",!0);var e=d("WADevToolMessageChannel").createNewChannel();b.content.devToolMessageChannelPort2=e.port2;a.postMessage(b,[e.port2])}else a.postMessage(b)}g.BridgeAdapter=e;g.initWorker=a}),98);
__d("MAWBridgeSendAndReceive",["MAWBridge","MAWBridgeLoggingUtils","MAWTimedBridge","MAWWorkerEvent"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e){var f=d("MAWBridgeLoggingUtils").getBridgeEventInstanceKey(b),g=(e==null?void 0:e.isLoggingDisabled)!==!0,h=d("MAWTimedBridge").bridgeTimeout(function(){g&&d("MAWBridgeLoggingUtils").routeStart("sendAndReceive",a,b,f);return d("MAWBridge").getBridge().sendAndReceive(a,b,c,e==null?void 0:e.isLoggingDisabled,{onAck:function(a){g&&d("MAWWorkerEvent").logAck(f,b,a)},onSend:function(a){var c=a.queueMsgs;a=a.queueSize;g&&(d("MAWWorkerEvent").logSend(f,b,"sendAndReceive"),d("MAWWorkerEvent").logAnnotations(f,{"int":{bridgeSize:a},string_array:{bridgeMsgs:c}}))}},{bridgeQPLInstanceKey:f}).then(function(c){g&&d("MAWBridgeLoggingUtils").routeSuccess(a,b,f);return c})["catch"](function(c){g&&d("MAWBridgeLoggingUtils").routeFail(a,b,c.message,f);throw c})},a,b,f,e==null?void 0:e.timeoutMs);return h}g.sendAndReceive=a}),98);
__d("MAWSecureDataSource",[],(function(a,b,c,d,e,f){"use strict";a=10;f.DEFAULT_NUM_MESSAGES=a}),66);
__d("MWEncryptedBackupsSharedState",["ReQL","ReQLSuspense","WebStorage","getMWEncryptedBackupsIsLocalStorageSupported","promiseDone","react","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=(j||d("react")).useCallback;function l(a){var b=a.db,c=a.stateKey;a=a.stateValue;var d=a===void 0?"true":a;return b.runInTransaction(function(a){return a.experiences_shared_state.upsert([c],{stateKey:c,stateValue:d})},"readwrite","background",void 0,f.id+":37")}function m(a){var b,e=a.db;a=a.stateKey;if(!d("getMWEncryptedBackupsIsLocalStorageSupported").getMWEncryptedBackupsIsLocalStorageSupported())return;b=(b=(h||(h=c("WebStorage"))).getLocalStorageForRead())==null?void 0:b.getItem(a);if(b!=null){var f;(f=(h||(h=c("WebStorage"))).getLocalStorage())==null?void 0:f.removeItem(a);c("promiseDone")(l({db:e,stateKey:a,stateValue:b}))}return b}function a(a){var b=a.db,c=a.sharedStateTable,d=a.stateKey;a=c.filter(function(a){return a.stateKey===d});if(a.length===0){c=m({db:b,stateKey:d});return c!=null}return!0}function b(a){var b=a.db,c=a.sharedStateTable,d=a.stateKey;a=c.filter(function(a){return a.stateKey===d});c=a[0];return(c==null?void 0:c.stateValue)!=null?c.stateValue:m({db:b,stateKey:d})}function e(a){var b=a.db,c=a.sharedStateRow;a=a.stateKey;return c==null?m({db:b,stateKey:a}):c.stateValue}function n(a){var b=a.db,c=a.stateKey;return b.runInTransaction(function(a){return a.experiences_shared_state["delete"](c)},"readwrite","background",void 0,f.id+":131")}function o(a){var b,e=(i||(i=c("useReStore")))();b=(b=d("ReQLSuspense").useFirst(function(){return d("ReQL").fromTableAscending(e.tables.experiences_shared_state).getKeyRange(a)},[e.tables.experiences_shared_state,a],f.id+":142"))==null?void 0:b.stateValue;var g=k(function(b){return l({db:e,stateKey:a,stateValue:b})},[e,a]);return[b,g]}function p(a){a=o(a);var b=a[0],c=a[1];a=k(function(){void c("true")},[c]);return[b==="true",a]}g.upsertEBSharedStateEntry=l;g.getEntryPresentInLocalStorage=m;g.getIsEntryPresentInSharedState=a;g.getEntryValueFromSharedState=b;g.getEntryValue=e;g.deleteEntry=n;g.useEBSharedStateEntry=o;g.useEBSharedStateEntryBoolean=p}),98);